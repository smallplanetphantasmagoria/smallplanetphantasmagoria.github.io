document.addEventListener('DOMContentLoaded', () => {
    // Constants and Global Variables
    const canvas = document.getElementById('globeCanvas');
    const ctx = canvas.getContext('2d');
    const frameWidth = 350;
    const frameHeight = 350;
    const cols = 15;
    const totalFrames = 150;
    const initialFrameInterval = 1000 / 16;  // 16 fps for initial animation
    const buttonFrameInterval = 1000 / 32;  // 32 fps for button press animation
    const scrollFrameInterval = 1000 / 64;  // 32 fps for button press animation
    const originalFrameWidth = 350;
    const originalFrameHeight = 350;
    let currentFrame = 10;  // Start at frame 10
    let animationInterval;
    let animationDirection = 1; // 1 for forward, -1 for backward
    let isAnimating = false; // Flag to track if animation is running
    let lastScrollTime = 0; // Initialize the lastScrollTime variable
    const spriteSheet = new Image();
    spriteSheet.src = 'sprite.webp';

    const clickableAreas = [
        {
            imageIndex: 10,
            areas: [
                {
                  "id": "mountain",
                  "points": [
                    {
                      "x": 181.94105,
                      "y": 116.39821
                    },
                    {
                      "x": 215.08531,
                      "y": 104.79771000000001
                    },
                    {
                      "x": 184.15067,
                      "y": 77.177492
                    }
                  ],
                  "href": "location/mountain.html"
                },
                {
                  "id": "crystal",
                  "points": [
                    {
                      "x": 188.2937,
                      "y": 145.12324
                    },
                    {
                      "x": 193.40344,
                      "y": 118.05542000000001
                    },
                    {
                      "x": 205.55633999999998,
                      "y": 113.22188000000001
                    },
                    {
                      "x": 223.64757999999998,
                      "y": 113.91239000000002
                    },
                    {
                      "x": 235.38617999999997,
                      "y": 137.38957000000002
                    },
                    {
                      "x": 226.27149999999997,
                      "y": 157.69044000000002
                    },
                    {
                      "x": 198.72529999999998,
                      "y": 165.70030000000003
                    }
                  ],
                  "href": "location/crystal.html"
                },
                {
                  "id": "mushroom",
                  "points": [
                    {
                      "x": 235.93944,
                      "y": 179.37231
                    },
                    {
                      "x": 220.05695,
                      "y": 217.76442
                    },
                    {
                      "x": 187.77083,
                      "y": 224.11707
                    },
                    {
                      "x": 168.68334,
                      "y": 204.50671
                    },
                    {
                      "x": 191.05571999999998,
                      "y": 169.70523
                    },
                    {
                      "x": 216.05085999999997,
                      "y": 164.31929
                    }
                  ],
                  "href": "location/mushroom.html"
                },
                {
                  "id": "santa",
                  "points": [
                    {
                      "x": 228.34302,
                      "y": 118.67687
                    },
                    {
                      "x": 238.97681,
                      "y": 138.35628
                    },
                    {
                      "x": 276.33316,
                      "y": 131.31313
                    },
                    {
                      "x": 275.09025,
                      "y": 124.75332
                    },
                    {
                      "x": 268.66854,
                      "y": 121.577
                    },
                    {
                      "x": 266.94228,
                      "y": 110.59796
                    },
                    {
                      "x": 263.97310999999996,
                      "y": 101.69044
                    },
                    {
                      "x": 259.13956999999994,
                      "y": 102.31188999999999
                    },
                    {
                      "x": 244.80294999999992,
                      "y": 123.92472
                    },
                    {
                      "x": 237.25053999999992,
                      "y": 106.59303
                    },
                    {
                      "x": 232.96940999999993,
                      "y": 107.14543
                    }
                  ],
                  "href": "location/santa.html"
                },
                {
                  "id": "north",
                  "points": [
                    {
                      "x": 224.33809,
                      "y": 111.15036
                    },
                    {
                      "x": 223.71662999999998,
                      "y": 89.46849
                    },
                    {
                      "x": 262.8683,
                      "y": 84.013496
                    },
                    {
                      "x": 280.61429,
                      "y": 87.88032700000001
                    },
                    {
                      "x": 277.36890999999997,
                      "y": 122.19845000000001
                    },
                    {
                      "x": 271.56867,
                      "y": 120.02868000000001
                    },
                    {
                      "x": 264.59456,
                      "y": 99.135568
                    },
                    {
                      "x": 256.65375,
                      "y": 100.37848000000001
                    },
                    {
                      "x": 245.46756,
                      "y": 117.08871
                    },
                    {
                      "x": 238.4244,
                      "y": 103.48575000000001
                    },
                    {
                      "x": 230.55264,
                      "y": 104.93581
                    },
                    {
                      "x": 227.03106,
                      "y": 114.74099000000001
                    }
                  ],
                  "href": "location/north.html"
                },
                {
                  "id": "cookie",
                  "points": [
                    {
                      "x": 256.90462,
                      "y": 157.4266
                    },
                    {
                      "x": 271.35715000000005,
                      "y": 174.80870000000002
                    },
                    {
                      "x": 327.01892000000004,
                      "y": 184.96453000000002
                    },
                    {
                      "x": 342.44797000000005,
                      "y": 152.93460000000002
                    },
                    {
                      "x": 339.71371000000005,
                      "y": 138.91529000000003
                    },
                    {
                      "x": 311.19926000000004,
                      "y": 141.02102000000002
                    },
                    {
                      "x": 302.80117,
                      "y": 139.50719
                    },
                    {
                      "x": 293.23125,
                      "y": 124.61545000000001
                    },
                    {
                      "x": 278.72989,
                      "y": 130.08398
                    },
                    {
                      "x": 274.62850000000003,
                      "y": 135.16189
                    }
                  ],
                  "href": "location/cookie.html"
                },
                {
                  "id": "skate",
                  "points": [
                    {
                      "x": 305.95584,
                      "y": 108.25024
                    },
                    {
                      "x": 303.81528000000003,
                      "y": 137.04432
                    },
                    {
                      "x": 293.73389000000003,
                      "y": 121.64605
                    },
                    {
                      "x": 279.37138000000004,
                      "y": 127.5844
                    },
                    {
                      "x": 279.57853000000006,
                      "y": 115.77675
                    },
                    {
                      "x": 302.57237000000003,
                      "y": 106.73113000000001
                    }
                  ],
                  "href": "location/skate.html"
                },
                {
                  "id": "digital",
                  "points": [
                    {
                      "x": 333.07336,
                      "y": 232.22821
                    },
                    {
                      "x": 340.29962,
                      "y": 243.55587
                    },
                    {
                      "x": 338.93249000000003,
                      "y": 256.64127
                    },
                    {
                      "x": 355.92398000000003,
                      "y": 256.25066000000004
                    },
                    {
                      "x": 381.89947,
                      "y": 267.38301
                    },
                    {
                      "x": 378.5793,
                      "y": 282.42145
                    },
                    {
                      "x": 348.30710999999997,
                      "y": 283.00737
                    },
                    {
                      "x": 339.32309999999995,
                      "y": 295.50685
                    },
                    {
                      "x": 327.01892,
                      "y": 297.85051
                    },
                    {
                      "x": 321.7457,
                      "y": 293.74911
                    },
                    {
                      "x": 294.20777,
                      "y": 288.08527999999995
                    },
                    {
                      "x": 298.50446999999997,
                      "y": 273.24215
                    },
                    {
                      "x": 312.76169999999996,
                      "y": 233.59533999999996
                    }
                  ],
                  "href": "location/digital.html"
                },
                {
                  "id": "cinema",
                  "points": [
                    {
                      "x": 312.85935,
                      "y": 323.53304
                    },
                    {
                      "x": 334.14753,
                      "y": 336.71609
                    },
                    {
                      "x": 359.53711000000004,
                      "y": 346.28601000000003
                    },
                    {
                      "x": 360.12303,
                      "y": 325.09548
                    },
                    {
                      "x": 340.59258000000005,
                      "y": 296.58103
                    },
                    {
                      "x": 329.21610000000004,
                      "y": 299.41294
                    }
                  ],
                  "href": "location/cinema.html"
                },
                {
                  "id": "cheese",
                  "points": [
                    {
                      "x": 310.23698,
                      "y": 330.04062
                    },
                    {
                      "x": 313.13710000000003,
                      "y": 304.07761
                    },
                    {
                      "x": 296.42687,
                      "y": 302.6966
                    },
                    {
                      "x": 282.06435,
                      "y": 298.38398
                    },
                    {
                      "x": 244.80294999999998,
                      "y": 303.38711
                    },
                    {
                      "x": 237.73389999999998,
                      "y": 307.39204
                    },
                    {
                      "x": 218.81403999999998,
                      "y": 314.5733
                    },
                    {
                      "x": 221.02365999999998,
                      "y": 321.50669
                    },
                    {
                      "x": 230.96693999999997,
                      "y": 335.84087
                    },
                    {
                      "x": 235.24807999999996,
                      "y": 335.84087
                    },
                    {
                      "x": 240.77211999999997,
                      "y": 331.97404
                    },
                    {
                      "x": 250.57729999999998,
                      "y": 344.81744
                    },
                    {
                      "x": 253.33932,
                      "y": 348.26997
                    },
                    {
                      "x": 262.31588999999997,
                      "y": 348.13186
                    },
                    {
                      "x": 278.05942,
                      "y": 330.17872
                    },
                    {
                      "x": 292.00763,
                      "y": 331.97404
                    },
                    {
                      "x": 300.4318,
                      "y": 336.25517
                    }
                  ],
                  "href": "location/cheese.html"
                },
                {
                  "id": "cactus",
                  "points": [
                    {
                      "x": 227.65251,
                      "y": 336.80757
                    },
                    {
                      "x": 217.29493,
                      "y": 336.39327
                    },
                    {
                      "x": 209.42317,
                      "y": 362.77058
                    },
                    {
                      "x": 237.31959,
                      "y": 365.94691
                    },
                    {
                      "x": 247.26287,
                      "y": 374.37108
                    },
                    {
                      "x": 268.11614,
                      "y": 373.68057
                    },
                    {
                      "x": 272.53537,
                      "y": 372.29956
                    },
                    {
                      "x": 268.80664,
                      "y": 347.00142999999997
                    },
                    {
                      "x": 263.1445,
                      "y": 351.86058999999995
                    },
                    {
                      "x": 251.82021,
                      "y": 351.4462899999999
                    },
                    {
                      "x": 240.49592,
                      "y": 337.9123799999999
                    }
                  ],
                  "href": "location/cactus.html"
                },
                {
                  "id": "volcano",
                  "points": [
                    {
                      "x": 223.09518,
                      "y": 329.76442
                    },
                    {
                      "x": 214.80911,
                      "y": 313.19228
                    },
                    {
                      "x": 216.05202,
                      "y": 304.76811999999995
                    },
                    {
                      "x": 212.18519,
                      "y": 289.85319999999996
                    },
                    {
                      "x": 197.96078,
                      "y": 286.95306999999997
                    },
                    {
                      "x": 185.94598,
                      "y": 292.47711999999996
                    },
                    {
                      "x": 185.80787999999998,
                      "y": 296.75825
                    },
                    {
                      "x": 174.20738999999998,
                      "y": 295.51534
                    },
                    {
                      "x": 170.20244999999997,
                      "y": 301.86798999999996
                    },
                    {
                      "x": 170.61675999999997,
                      "y": 319.13062999999994
                    },
                    {
                      "x": 184.42686999999998,
                      "y": 317.4734199999999
                    },
                    {
                      "x": 179.59332999999998,
                      "y": 346.33654999999993
                    },
                    {
                      "x": 198.92747999999997,
                      "y": 333.21694999999994
                    },
                    {
                      "x": 200.58469999999997,
                      "y": 347.02705999999995
                    }
                  ],
                  "href": "location/volcano.html"
                },
                {
                  "id": "pharaoh",
                  "points": [
                    {
                      "x": 161.50208,
                      "y": 287.91978
                    },
                    {
                      "x": 168.13094,
                      "y": 303.73236
                    },
                    {
                      "x": 168.33809000000002,
                      "y": 320.23544000000004
                    },
                    {
                      "x": 170.68581000000003,
                      "y": 322.03076000000004
                    },
                    {
                      "x": 182.01010000000002,
                      "y": 319.68304000000006
                    },
                    {
                      "x": 178.62662000000003,
                      "y": 338.60289000000006
                    },
                    {
                      "x": 154.66608000000002,
                      "y": 343.78168000000005
                    },
                    {
                      "x": 154.18272000000002,
                      "y": 307.80634000000003
                    },
                    {
                      "x": 148.31343,
                      "y": 307.87544
                    },
                    {
                      "x": 149.97064,
                      "y": 288.33414000000005
                    }
                  ],
                  "href": "location/pharaoh.html"
                },
                {
                  "id": "skull",
                  "points": [
                    {
                      "x": 119.80089,
                      "y": 228.61508
                    },
                    {
                      "x": 134.83933,
                      "y": 223.73247
                    },
                    {
                      "x": 146.16699,
                      "y": 245.1183
                    },
                    {
                      "x": 129.37081,
                      "y": 266.40649
                    },
                    {
                      "x": 107.1061,
                      "y": 255.95770000000002
                    },
                    {
                      "x": 105.54366,
                      "y": 235.15778
                    }
                  ],
                  "href": "location/skull.html"
                },
                {
                  "id": "rainbow",
                  "points": [
                    {
                      "x": 154.36978,
                      "y": 164.45756
                    },
                    {
                      "x": 178.88048999999998,
                      "y": 141.31398000000002
                    },
                    {
                      "x": 173.99787999999998,
                      "y": 131.06050000000002
                    },
                    {
                      "x": 157.397,
                      "y": 130.18163
                    },
                    {
                      "x": 145.19047,
                      "y": 137.01728
                    },
                    {
                      "x": 143.23742000000001,
                      "y": 146.68485
                    },
                    {
                      "x": 146.65525000000002,
                      "y": 157.81721000000002
                    }
                  ],
                  "href": "location/rainbow.html"
                }
              ]
        },
        {   imageIndex: 20,
            areas: [
                {
                  "id": "cookie",
                  "points": [
                    {
                      "x": 286.20029,
                      "y": 183.79271
                    },
                    {
                      "x": 301.04343,
                      "y": 172.85566
                    },
                    {
                      "x": 302.21526,
                      "y": 164.26226
                    },
                    {
                      "x": 308.465,
                      "y": 155.66886
                    },
                    {
                      "x": 304.94951999999995,
                      "y": 144.73181
                    },
                    {
                      "x": 297.52795,
                      "y": 141.60694
                    },
                    {
                      "x": 284.63786,
                      "y": 144.73181
                    },
                    {
                      "x": 282.68480999999997,
                      "y": 150.59094
                    },
                    {
                      "x": 274.48202999999995,
                      "y": 141.60693999999998
                    },
                    {
                      "x": 265.88863,
                      "y": 139.26328999999998
                    },
                    {
                      "x": 262.76376,
                      "y": 138.09145999999998
                    },
                    {
                      "x": 261.59193,
                      "y": 131.84171999999998
                    },
                    {
                      "x": 258.46706,
                      "y": 127.15440999999998
                    },
                    {
                      "x": 252.60793,
                      "y": 123.63892999999999
                    },
                    {
                      "x": 244.80295,
                      "y": 126.76379999999999
                    },
                    {
                      "x": 236.98357000000001,
                      "y": 131.45111
                    },
                    {
                      "x": 237.76479,
                      "y": 141.21633
                    },
                    {
                      "x": 222.14043,
                      "y": 143.55999
                    },
                    {
                      "x": 224.09347,
                      "y": 161.91861
                    },
                    {
                      "x": 238.1554,
                      "y": 171.68383
                    }
                  ],
                  "href": "location/cookie.html"
                },
                {
                  "id": "skate",
                  "points": [
                    {
                      "x": 288.41701,
                      "y": 139.53014
                    },
                    {
                      "x": 290.07422,
                      "y": 123.99376999999998
                    },
                    {
                      "x": 289.17656000000005,
                      "y": 117.43396999999999
                    },
                    {
                      "x": 288.96941000000004,
                      "y": 112.39326999999999
                    },
                    {
                      "x": 282.61676000000006,
                      "y": 106.80017999999998
                    },
                    {
                      "x": 277.23082000000005,
                      "y": 107.00732999999998
                    },
                    {
                      "x": 272.67348000000004,
                      "y": 110.11460999999998
                    },
                    {
                      "x": 269.84241000000003,
                      "y": 114.60288999999999
                    },
                    {
                      "x": 269.22095,
                      "y": 116.60535999999999
                    },
                    {
                      "x": 264.52551,
                      "y": 122.12939999999999
                    },
                    {
                      "x": 262.79925,
                      "y": 126.13432999999999
                    },
                    {
                      "x": 262.93735,
                      "y": 129.86306
                    },
                    {
                      "x": 264.04215999999997,
                      "y": 132.34887999999998
                    },
                    {
                      "x": 264.87077,
                      "y": 134.97280999999998
                    },
                    {
                      "x": 268.80665,
                      "y": 137.59672999999998
                    },
                    {
                      "x": 272.32822999999996,
                      "y": 138.42532999999997
                    },
                    {
                      "x": 279.78569,
                      "y": 140.01349999999996
                    }
                  ],
                  "href": "location/skate.html"
                },
                {
                  "id": "santa",
                  "points": [
                    {
                      "x": 252.64882,
                      "y": 121.09365
                    },
                    {
                      "x": 243.46509,
                      "y": 102.5881
                    },
                    {
                      "x": 238.21725,
                      "y": 105.21202
                    },
                    {
                      "x": 233.86707,
                      "y": 113.35998
                    },
                    {
                      "x": 230.13834,
                      "y": 120.40314
                    },
                    {
                      "x": 225.51195,
                      "y": 121.50795
                    },
                    {
                      "x": 223.16423,
                      "y": 114.32669
                    },
                    {
                      "x": 217.29493,
                      "y": 108.31929
                    },
                    {
                      "x": 211.83993999999998,
                      "y": 109.4241
                    },
                    {
                      "x": 208.59455999999997,
                      "y": 113.63619
                    },
                    {
                      "x": 209.00886999999997,
                      "y": 123.57947
                    },
                    {
                      "x": 209.07796999999997,
                      "y": 129.17256
                    },
                    {
                      "x": 210.18277999999995,
                      "y": 132.00363000000002
                    },
                    {
                      "x": 212.18523999999996,
                      "y": 136.63002
                    },
                    {
                      "x": 217.77833999999996,
                      "y": 138.14913
                    },
                    {
                      "x": 225.78819999999996,
                      "y": 135.24901000000003
                    },
                    {
                      "x": 231.45034999999996,
                      "y": 131.38218000000003
                    },
                    {
                      "x": 237.45774999999995,
                      "y": 129.31066000000004
                    },
                    {
                      "x": 242.36033999999995,
                      "y": 126.54864000000003
                    }
                  ],
                  "href": "location/santa.html"
                },
                {
                  "id": "crystal",
                  "points": [
                    {
                      "x": 194.4392,
                      "y": 115.7077
                    },
                    {
                      "x": 208.08742,
                      "y": 131.31313
                    },
                    {
                      "x": 210.52798,
                      "y": 136.63002
                    },
                    {
                      "x": 203.76103,
                      "y": 148.23051
                    },
                    {
                      "x": 196.02736000000002,
                      "y": 155.06652
                    },
                    {
                      "x": 175.45030000000003,
                      "y": 165.00979999999998
                    },
                    {
                      "x": 161.50208000000003,
                      "y": 146.64235
                    },
                    {
                      "x": 163.43550000000005,
                      "y": 135.17996
                    },
                    {
                      "x": 166.33562000000003,
                      "y": 132.14173
                    },
                    {
                      "x": 166.33562000000003,
                      "y": 118.74593
                    },
                    {
                      "x": 169.23575000000002,
                      "y": 112.39328
                    },
                    {
                      "x": 176.96941000000004,
                      "y": 112.94568000000001
                    }
                  ],
                  "href": "location/crystal.html"
                },
                {
                  "id": "mushroom",
                  "points": [
                    {
                      "x": 184.56497,
                      "y": 204.64482
                    },
                    {
                      "x": 195.33686,
                      "y": 188.34889
                    },
                    {
                      "x": 194.09395,
                      "y": 178.81991000000002
                    },
                    {
                      "x": 184.84117,
                      "y": 171.77675000000002
                    },
                    {
                      "x": 177.65992,
                      "y": 167.08132000000003
                    },
                    {
                      "x": 169.92625,
                      "y": 167.08132000000003
                    },
                    {
                      "x": 157.63525,
                      "y": 166.80511000000004
                    },
                    {
                      "x": 151.0064,
                      "y": 173.71017000000003
                    },
                    {
                      "x": 146.03476,
                      "y": 181.16763000000003
                    },
                    {
                      "x": 140.37261,
                      "y": 191.38711000000004
                    },
                    {
                      "x": 136.50578000000002,
                      "y": 199.53508000000005
                    },
                    {
                      "x": 134.84857000000002,
                      "y": 208.78785000000005
                    },
                    {
                      "x": 141.61552000000003,
                      "y": 214.31190000000004
                    },
                    {
                      "x": 150.17779000000004,
                      "y": 220.11214000000004
                    },
                    {
                      "x": 163.71170000000004,
                      "y": 222.59796000000003
                    },
                    {
                      "x": 178.07422000000003,
                      "y": 220.94075000000004
                    },
                    {
                      "x": 184.42687000000004,
                      "y": 205.19722000000004
                    }
                  ],
                  "href": "location/mushroom.html"
                },
                {
                  "id": "pirate",
                  "points": [
                    {
                      "x": 132.30038,
                      "y": 254.49292
                    },
                    {
                      "x": 131.32385,
                      "y": 233.59534
                    },
                    {
                      "x": 123.90227999999999,
                      "y": 225.78316999999998
                    },
                    {
                      "x": 113.35583999999999,
                      "y": 226.76689
                    },
                    {
                      "x": 108.66854,
                      "y": 232.61882
                    },
                    {
                      "x": 105.73897,
                      "y": 240.6263
                    },
                    {
                      "x": 108.47323,
                      "y": 249.80560999999997
                    },
                    {
                      "x": 115.8948,
                      "y": 253.71169999999998
                    },
                    {
                      "x": 122.53515,
                      "y": 258.98492
                    },
                    {
                      "x": 131.32385,
                      "y": 257.22718
                    }
                  ],
                  "href": "location/pirate.html"
                },
                {
                  "id": "cheese",
                  "points": [
                    {
                      "x": 190.69641,
                      "y": 315.81852
                    },
                    {
                      "x": 193.23537,
                      "y": 324.02130999999997
                    },
                    {
                      "x": 194.79781,
                      "y": 331.24757
                    },
                    {
                      "x": 198.31329,
                      "y": 335.15366
                    },
                    {
                      "x": 203.97711999999999,
                      "y": 334.95836
                    },
                    {
                      "x": 209.83624999999998,
                      "y": 333.78653
                    },
                    {
                      "x": 211.59399,
                      "y": 337.10671
                    },
                    {
                      "x": 216.86721,
                      "y": 346.67663000000005
                    },
                    {
                      "x": 219.60147,
                      "y": 348.62967000000003
                    },
                    {
                      "x": 224.48408,
                      "y": 349.21558000000005
                    },
                    {
                      "x": 229.17139,
                      "y": 349.21558000000005
                    },
                    {
                      "x": 233.8587,
                      "y": 340.81749
                    },
                    {
                      "x": 242.8427,
                      "y": 334.17714
                    },
                    {
                      "x": 249.28775000000002,
                      "y": 330.85697
                    },
                    {
                      "x": 263.34967,
                      "y": 334.95835999999997
                    },
                    {
                      "x": 269.20881,
                      "y": 335.93487999999996
                    },
                    {
                      "x": 278.97403,
                      "y": 331.24756999999994
                    },
                    {
                      "x": 283.07542,
                      "y": 315.62321999999995
                    },
                    {
                      "x": 282.48951,
                      "y": 307.6157299999999
                    },
                    {
                      "x": 276.43507,
                      "y": 300.9753799999999
                    },
                    {
                      "x": 266.66985,
                      "y": 301.1706899999999
                    },
                    {
                      "x": 259.44358,
                      "y": 304.68616999999995
                    },
                    {
                      "x": 252.60793,
                      "y": 300.38946999999996
                    },
                    {
                      "x": 244.80295,
                      "y": 296.67868
                    },
                    {
                      "x": 227.99956,
                      "y": 300.38946999999996
                    },
                    {
                      "x": 214.91416,
                      "y": 296.67868
                    },
                    {
                      "x": 202.60998,
                      "y": 303.70965
                    },
                    {
                      "x": 191.47763,
                      "y": 309.56878
                    }
                  ],
                  "href": "location/cheese.html"
                },
                {
                  "id": "cactus",
                  "points": [
                    {
                      "x": 238.64366,
                      "y": 373.9216
                    },
                    {
                      "x": 249.48305000000002,
                      "y": 376.55821000000003
                    },
                    {
                      "x": 257.78349000000003,
                      "y": 372.74977
                    },
                    {
                      "x": 260.71306000000004,
                      "y": 361.22681
                    },
                    {
                      "x": 260.61536000000007,
                      "y": 352.0475
                    },
                    {
                      "x": 256.6116200000001,
                      "y": 344.91889000000003
                    },
                    {
                      "x": 243.72152000000008,
                      "y": 336.03253
                    },
                    {
                      "x": 238.64361000000008,
                      "y": 341.0128
                    },
                    {
                      "x": 234.8351700000001,
                      "y": 345.21184000000005
                    },
                    {
                      "x": 232.8821300000001,
                      "y": 349.71558000000005
                    },
                    {
                      "x": 229.4398800000001,
                      "y": 354.51322000000005
                    },
                    {
                      "x": 223.2389700000001,
                      "y": 354.44002000000006
                    },
                    {
                      "x": 220.0896800000001,
                      "y": 352.3405000000001
                    },
                    {
                      "x": 217.6972000000001,
                      "y": 350.65600000000006
                    },
                    {
                      "x": 214.53286000000008,
                      "y": 348.27001000000007
                    },
                    {
                      "x": 210.6660300000001,
                      "y": 340.0184700000001
                    },
                    {
                      "x": 209.4455900000001,
                      "y": 337.9856200000001
                    },
                    {
                      "x": 205.7348100000001,
                      "y": 337.3997100000001
                    },
                    {
                      "x": 202.1216700000001,
                      "y": 341.4034500000001
                    },
                    {
                      "x": 198.6061900000001,
                      "y": 347.7508400000001
                    },
                    {
                      "x": 194.60245000000012,
                      "y": 352.8287600000001
                    },
                    {
                      "x": 192.8447100000001,
                      "y": 357.6137200000001
                    },
                    {
                      "x": 198.9968000000001,
                      "y": 366.01181000000014
                    }
                  ],
                  "href": "location/cactus.html"
                },
                {
                  "id": "lightbulb",
                  "points": [
                    {
                      "x": 282.2942,
                      "y": 335.38683
                    },
                    {
                      "x": 295.08664999999996,
                      "y": 330.56401
                    },
                    {
                      "x": 303.97299999999996,
                      "y": 327.9274
                    },
                    {
                      "x": 308.17204999999996,
                      "y": 329.29452999999995
                    },
                    {
                      "x": 312.27343999999994,
                      "y": 331.8334899999999
                    },
                    {
                      "x": 314.8123999999999,
                      "y": 334.6653999999999
                    },
                    {
                      "x": 315.98421999999994,
                      "y": 338.76679999999993
                    },
                    {
                      "x": 313.44526999999994,
                      "y": 344.0400199999999
                    },
                    {
                      "x": 303.77768999999995,
                      "y": 349.71557999999993
                    },
                    {
                      "x": 293.91481999999996,
                      "y": 347.55549999999994
                    },
                    {
                      "x": 286.98150999999996,
                      "y": 343.06348999999994
                    },
                    {
                      "x": 281.80593999999996,
                      "y": 341.11044999999996
                    }
                  ],
                  "href": "location/lightbulb.html"
                },
                {
                  "id": "cinema",
                  "points": [
                    {
                      "x": 296.94204,
                      "y": 323.92366
                    },
                    {
                      "x": 297.03964,
                      "y": 316.50209
                    },
                    {
                      "x": 299.5786,
                      "y": 308.4946
                    },
                    {
                      "x": 306.51191,
                      "y": 302.53782
                    },
                    {
                      "x": 312.76165,
                      "y": 297.94816000000003
                    },
                    {
                      "x": 318.42548,
                      "y": 294.62799
                    },
                    {
                      "x": 323.01513,
                      "y": 294.82329
                    },
                    {
                      "x": 328.97192,
                      "y": 296.14034
                    },
                    {
                      "x": 333.65923000000004,
                      "y": 307.61573
                    },
                    {
                      "x": 336.58879,
                      "y": 315.03729999999996
                    },
                    {
                      "x": 336.9794,
                      "y": 322.92796
                    },
                    {
                      "x": 337.95593,
                      "y": 331.44288
                    },
                    {
                      "x": 340.29958000000005,
                      "y": 337.10671
                    },
                    {
                      "x": 340.49488,
                      "y": 339.84097
                    },
                    {
                      "x": 336.00288,
                      "y": 338.82485
                    },
                    {
                      "x": 324.08931,
                      "y": 338.82485
                    },
                    {
                      "x": 317.21104,
                      "y": 334.94321
                    },
                    {
                      "x": 314.79427000000004,
                      "y": 332.18119
                    },
                    {
                      "x": 312.10130000000004,
                      "y": 329.21202
                    },
                    {
                      "x": 309.68453000000005,
                      "y": 327.40381
                    },
                    {
                      "x": 304.50574000000006,
                      "y": 324.99993
                    },
                    {
                      "x": 297.7387800000001,
                      "y": 325.75949
                    }
                  ],
                  "href": "location/cinema.html"
                },
                {
                  "id": "digital",
                  "points": [
                    {
                      "x": 318.74114,
                      "y": 282.42146
                    },
                    {
                      "x": 337.56537,
                      "y": 284.17920000000004
                    },
                    {
                      "x": 351.04137,
                      "y": 283.39798
                    },
                    {
                      "x": 357.68172999999996,
                      "y": 282.22615
                    },
                    {
                      "x": 360.41598999999997,
                      "y": 274.99989
                    },
                    {
                      "x": 355.14277,
                      "y": 264.06284
                    },
                    {
                      "x": 345.18224,
                      "y": 255.07882999999998
                    },
                    {
                      "x": 328.38606,
                      "y": 257.81309999999996
                    },
                    {
                      "x": 316.51724,
                      "y": 256.44597
                    },
                    {
                      "x": 307.09787,
                      "y": 253.51639999999998
                    },
                    {
                      "x": 300.26221,
                      "y": 252.53987999999998
                    },
                    {
                      "x": 296.44066999999995,
                      "y": 241.60282999999998
                    },
                    {
                      "x": 287.76273,
                      "y": 231.44698999999997
                    },
                    {
                      "x": 277.41159,
                      "y": 232.42351999999997
                    },
                    {
                      "x": 265.88863,
                      "y": 240.43099999999995
                    },
                    {
                      "x": 261.21373,
                      "y": 246.68073999999996
                    },
                    {
                      "x": 272.13837,
                      "y": 254.49291999999997
                    },
                    {
                      "x": 273.3102,
                      "y": 262.10979999999995
                    },
                    {
                      "x": 277.99751000000003,
                      "y": 274.21867
                    },
                    {
                      "x": 285.22377000000006,
                      "y": 283.59328999999997
                    },
                    {
                      "x": 286.39560000000006,
                      "y": 291.99138
                    },
                    {
                      "x": 296.44067000000007,
                      "y": 299.80356
                    },
                    {
                      "x": 303.77769000000006,
                      "y": 297.65521
                    }
                  ],
                  "href": "location/digital.html"
                },
                {
                  "id": "artificial",
                  "points": [
                    {
                      "x": 358.46294,
                      "y": 211.72124
                    },
                    {
                      "x": 367.64225,
                      "y": 215.04142
                    },
                    {
                      "x": 371.54834,
                      "y": 217.77568
                    },
                    {
                      "x": 374.47791,
                      "y": 224.02543
                    },
                    {
                      "x": 375.84504,
                      "y": 230.92482
                    },
                    {
                      "x": 375.84504,
                      "y": 236.52491
                    },
                    {
                      "x": 371.93895,
                      "y": 240.2357
                    },
                    {
                      "x": 367.64225,
                      "y": 247.46196
                    },
                    {
                      "x": 359.63477,
                      "y": 248.04787000000002
                    },
                    {
                      "x": 355.14277,
                      "y": 245.89952000000002
                    },
                    {
                      "x": 353.18971999999997,
                      "y": 239.84509000000003
                    },
                    {
                      "x": 352.2132,
                      "y": 230.92482000000004
                    },
                    {
                      "x": 353.18971999999997,
                      "y": 224.41603000000003
                    },
                    {
                      "x": 354.36154999999997,
                      "y": 216.21325000000004
                    }
                  ],
                  "href": "location/artificial.html"
                },
                {
                  "id": "moon",
                  "points": [
                    {
                      "x": 397.52384,
                      "y": 120.29485
                    },
                    {
                      "x": 402.21114,
                      "y": 110.94414
                    },
                    {
                      "x": 401.42993,
                      "y": 106.29287000000001
                    },
                    {
                      "x": 399.47688,
                      "y": 97.07752300000001
                    },
                    {
                      "x": 395.57079,
                      "y": 91.60899800000001
                    },
                    {
                      "x": 387.56331,
                      "y": 90.24186700000001
                    },
                    {
                      "x": 378.384,
                      "y": 90.63247600000001
                    },
                    {
                      "x": 373.892,
                      "y": 100.20239000000001
                    },
                    {
                      "x": 373.11078,
                      "y": 106.29287000000001
                    },
                    {
                      "x": 376.34504,
                      "y": 117.38919000000001
                    },
                    {
                      "x": 382.09477999999996,
                      "y": 124.81076000000002
                    }
                  ],
                  "href": "location/moon.html"
                },
                {
                  "id": "volcano",
                  "points": [
                    {
                      "x": 193.52832,
                      "y": 333.10296
                    },
                    {
                      "x": 188.35276000000002,
                      "y": 313.76782
                    },
                    {
                      "x": 181.22414,
                      "y": 296.14034
                    },
                    {
                      "x": 171.16596,
                      "y": 292.47963
                    },
                    {
                      "x": 165.11152,
                      "y": 292.08903
                    },
                    {
                      "x": 155.83456,
                      "y": 292.18672999999995
                    },
                    {
                      "x": 150.65899000000002,
                      "y": 297.5576
                    },
                    {
                      "x": 144.89751,
                      "y": 307.51813
                    },
                    {
                      "x": 144.60455000000002,
                      "y": 316.30683
                    },
                    {
                      "x": 150.46369,
                      "y": 320.60353
                    },
                    {
                      "x": 159.35004,
                      "y": 321.28709
                    },
                    {
                      "x": 158.17822,
                      "y": 343.84475999999995
                    },
                    {
                      "x": 163.15848,
                      "y": 347.16492999999997
                    },
                    {
                      "x": 175.36500999999998,
                      "y": 338.76683999999995
                    },
                    {
                      "x": 174.97439999999997,
                      "y": 347.84849999999994
                    }
                  ],
                  "href": "location/volcano.html"
                },
                {
                  "id": "mountain",
                  "points": [
                    {
                      "x": 179.36875,
                      "y": 108.99109
                    },
                    {
                      "x": 196.16493,
                      "y": 111.13944
                    },
                    {
                      "x": 202.02407,
                      "y": 101.56952999999999
                    },
                    {
                      "x": 181.12649,
                      "y": 81.45316599999998
                    }
                  ],
                  "href": "location/mountain.html"
                },
                {
                  "id": "north",
                  "points": [
                    {
                      "x": 254.17036,
                      "y": 108.99109
                    },
                    {
                      "x": 270.57592999999997,
                      "y": 80.344955
                    },
                    {
                      "x": 276.43507,
                      "y": 103.71787
                    },
                    {
                      "x": 259.63888,
                      "y": 116.80327
                    }
                  ],
                  "href": "location/north.html"
                }
              ]
        },
        {   imageIndex: 150,
            areas: []
        }
        // Add more frames and their areas as needed
    ];

    // Initialize
    spriteSheet.onload = () => {
        resizeCanvas(); // Initial draw
        drawFrame(currentFrame); // Ensure initial frame is drawn
        window.addEventListener('resize', resizeCanvas);
        startAnimation(true, initialFrameInterval); // Start initial animation at 16fps
    };

    // Resize Canvas
    function resizeCanvas() {
        const size = Math.min(window.innerWidth, window.innerHeight, 500);
        canvas.width = size;
        canvas.height = size;
        drawFrame(currentFrame);
    }

// Define manual offset variables
let offsetX = -70;
let offsetY = -50;

// Draw Frame
function drawFrame(frameIndex) {
    const x = ((frameIndex - 1) % cols) * frameWidth;
    const y = Math.floor((frameIndex - 1) / cols) * frameHeight;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(spriteSheet, x, y, frameWidth, frameHeight, 0, 0, canvas.width, canvas.height);

    // Draw clickable areas with a red outline
    const currentFrameAreas = clickableAreas.find(area => area.imageIndex === frameIndex);
    if (currentFrameAreas) {
        const scaleX = canvas.width / originalFrameWidth;
        const scaleY = canvas.height / originalFrameHeight;
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 2;
        currentFrameAreas.areas.forEach(area => {
            ctx.beginPath();
            ctx.moveTo((area.points[0].x + offsetX) * scaleX, (area.points[0].y + offsetY) * scaleY);
            for (let i = 1; i < area.points.length; i++) {
                ctx.lineTo((area.points[i].x + offsetX) * scaleX, (area.points[i].y + offsetY) * scaleY);
            }
            ctx.closePath();
            ctx.stroke();
        });
    }

    // Update frame info
    frameInfo.textContent = `Test ver. 0.4 || Frame: ${frameIndex}`;
};
    

    // Start Animation
    function startAnimation(forward = true, interval = initialFrameInterval) {
        clearInterval(animationInterval);  // Clear any existing interval
        animationDirection = forward ? 1 : -1;

        if (isAnimating && interval === buttonFrameInterval) {
            animationInterval = setInterval(updateFrame, interval);
            return; // Prevent starting multiple button animations
        }

        isAnimating = true;
        animationInterval = setInterval(updateFrame, interval);
    }

    // Update Frame
    function updateFrame() {
        currentFrame = (currentFrame + animationDirection - 1 + totalFrames) % totalFrames + 1;
        drawFrame(currentFrame);
    }

    // Stop Animation at Nearest Multiple of 10 in the Correct Direction
    function stopAnimationNearest(direction) {
        clearInterval(animationInterval);
        animationInterval = setInterval(() => {
            currentFrame = (currentFrame + direction - 1 + totalFrames) % totalFrames + 1;
            drawFrame(currentFrame);

            // Ensure stopping on next multiple of 10 in the correct direction
            if (currentFrame % 10 === 0) {
                clearInterval(animationInterval);
                isAnimating = false; // Reset the flag
            }
        }, buttonFrameInterval);
    }

// Slow Down Animation and Stop at Nearest Multiple of 10
function slowDownAnimationNearest(direction) {
    clearInterval(animationInterval);
    isAnimating = true;

    let interval = buttonFrameInterval;
    const decelerationFactor = 1.5; // Factor by which to slow down each step
    const minInterval = 1000 / 13; // Minimum interval for 12fps

    function decelerate() {
        currentFrame = (currentFrame + direction - 1 + totalFrames) % totalFrames + 1;
        drawFrame(currentFrame);

        if (currentFrame % 10 === 0 && interval >= minInterval) {
            clearInterval(animationInterval);
            isAnimating = false; // Reset the flag
        } else {
            interval = Math.min(interval * decelerationFactor, minInterval);
            clearInterval(animationInterval);
            animationInterval = setInterval(decelerate, interval);
        }
    }

    animationInterval = setInterval(decelerate, interval);
}

    // Handle Key Down
    function handleKeyDown(event) {
        if ((event.key === 'ArrowLeft' || event.key === 'ArrowRight') && !keyPressed) {
            keyPressed = true;
            startAnimation(event.key === 'ArrowRight', buttonFrameInterval);
        }
    }

    // Handle Key Up
    function handleKeyUp(event) {
        if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
            keyPressed = false;
            stopAnimationNearest(event.key === 'ArrowRight' ? 1 : -1);
        }
    }

        // Handle Scroll
        function handleScroll(event) {
          const now = Date.now();
          if (now - lastScrollTime < scrollFrameInterval) return;
          lastScrollTime = now;

          clearInterval(animationInterval); // Stop any currently running animations
          isAnimating = false; // Reset the flag

          const delta = event.deltaY > 0 ? 1 : -1;
          animationDirection = delta; // Set the animation direction based on the scroll direction
          currentFrame = (currentFrame + delta - 1 + totalFrames) % totalFrames + 1;
          drawFrame(currentFrame);

          // Ensure the animation stops on multiples of 10
          stopAnimationNearest(delta);
      }

    // Handle Touch Start
    function handleTouchStart(event) {
        event.preventDefault();
        const button = event.target;
        button.style.opacity = '1';

        if (button.id.includes('leftButton')) {
            startAnimation(false, buttonFrameInterval);
        } else if (button.id.includes('rightButton')) {
            startAnimation(true, buttonFrameInterval);
        }

        button.addEventListener('touchend', function touchEnd() {
            button.style.opacity = '0.2';
            stopAnimationNearest(button.id.includes('rightButton') ? 1 : -1);
            button.removeEventListener('touchend', touchEnd);
        });

        button.addEventListener('touchmove', function touchMove() {
            button.style.opacity = '0.2';
            stopAnimationNearest(button.id.includes('rightButton') ? 1 : -1);
            button.removeEventListener('touchmove', touchMove);
        });
    }

    // Handle Touch Start for Refresh Buttons
    function handleRefreshTouchStart(event) {
        event.preventDefault();
        const button = event.target;
        button.style.opacity = '1';

        startAnimation(true, initialFrameInterval); // Mimic the click behavior

        button.addEventListener('touchend', function touchEnd() {
            button.style.opacity = '0.2';
            button.removeEventListener('touchend', touchEnd);
        });

        button.addEventListener('touchmove', function touchMove() {
            button.style.opacity = '0.2';
            button.removeEventListener('touchmove', touchMove);
        });
    }

// Handle Click Events
canvas.addEventListener('click', function(event) {
    const rect = canvas.getBoundingClientRect();
    const x = (event.clientX - rect.left) * (canvas.width / rect.width);
    const y = (event.clientY - rect.top) * (canvas.height / rect.height);

    const currentFrameAreas = clickableAreas.find(area => area.imageIndex === currentFrame);
    if (currentFrameAreas) {
        const scaleX = canvas.width / originalFrameWidth;
        const scaleY = canvas.height / originalFrameHeight;
        currentFrameAreas.areas.forEach(area => {
            const translatedPoints = area.points.map(point => ({
                x: (point.x + offsetX) * scaleX,
                y: (point.y + offsetY) * scaleY
            }));
            if (isPointInPolygon({ x, y }, translatedPoints)) {
                handleClick(area.href);
            }
        });
    }
});

// Cursor change on hover
canvas.addEventListener('mousemove', function(event) {
    const rect = canvas.getBoundingClientRect();
    const x = (event.clientX - rect.left) * (canvas.width / rect.width);
    const y = (event.clientY - rect.top) * (canvas.height / rect.height);

    const currentFrameAreas = clickableAreas.find(area => area.imageIndex === currentFrame);
    if (currentFrameAreas) {
        const scaleX = canvas.width / originalFrameWidth;
        const scaleY = canvas.height / originalFrameHeight;
        let isHovering = false;
        currentFrameAreas.areas.forEach(area => {
            const translatedPoints = area.points.map(point => ({
                x: (point.x + offsetX) * scaleX,
                y: (point.y + offsetY) * scaleY
            }));
            if (isPointInPolygon({ x, y }, translatedPoints)) {
                isHovering = true;
            }
        });
        canvas.style.cursor = isHovering ? 'pointer' : 'default';
    } else {
        canvas.style.cursor = 'default';
    }
});

// Handle iframe src change
    function handleClick(href) {
        document.getElementById('overlay').style.opacity = '1';
        setTimeout(() => {
            if (href) {
                let iframe = document.getElementById('clickableIframe');
                iframe.src = href;
                iframe.style.display = 'block'; // Show the iframe
            }
            setTimeout(() => {
                if (href) {
                    document.getElementById('overlay').style.opacity = '0';
                }
            }, 1000); 
        }, 1000); 
        
    };


    function isPointInPolygon(point, vs) {
        let x = point.x, y = point.y;
    
        let inside = false;
        for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
            let xi = vs[i].x, yi = vs[i].y;
            let xj = vs[j].x, yj = vs[j].y;
    
            let intersect = ((yi > y) != (yj > y)) &&
                (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
    
        return inside;
    };
    
    

    // Add event listeners
    function addEventListeners() {
        setTimeout(() => {
            // Horizontal buttons
            document.getElementById('leftButtonHorizontal').addEventListener('mousedown', () => startAnimation(false, buttonFrameInterval));
            document.getElementById('rightButtonHorizontal').addEventListener('mousedown', () => startAnimation(true, buttonFrameInterval));
            document.getElementById('leftButtonHorizontal').addEventListener('mouseup', () => stopAnimationNearest(-1));
            document.getElementById('rightButtonHorizontal').addEventListener('mouseup', () => stopAnimationNearest(1));

            // Add touch event listeners for horizontal buttons
            document.getElementById('leftButtonHorizontal').addEventListener('touchstart', handleTouchStart);
            document.getElementById('rightButtonHorizontal').addEventListener('touchstart', handleTouchStart);

            // Vertical buttons
            document.getElementById('leftButtonVertical').addEventListener('mousedown', () => startAnimation(false, buttonFrameInterval));
            document.getElementById('rightButtonVertical').addEventListener('mousedown', () => startAnimation(true, buttonFrameInterval));
            document.getElementById('leftButtonVertical').addEventListener('mouseup', () => stopAnimationNearest(-1));
            document.getElementById('rightButtonVertical').addEventListener('mouseup', () => stopAnimationNearest(1));

            // Add touch event listeners for vertical buttons
            document.getElementById('leftButtonVertical').addEventListener('touchstart', handleTouchStart);
            document.getElementById('rightButtonVertical').addEventListener('touchstart', handleTouchStart);

            // Refresh buttons
            document.getElementById('refreshButton').addEventListener('click', () => startAnimation(true, initialFrameInterval));
            document.getElementById('refreshButtonVertical').addEventListener('click', () => startAnimation(true, initialFrameInterval));
            document.getElementById('refreshButtonBottomRight').addEventListener('click', () => startAnimation(true, initialFrameInterval));

            // Add touch event listeners for refresh buttons
            document.getElementById('refreshButton').addEventListener('touchstart', handleRefreshTouchStart);
            document.getElementById('refreshButtonVertical').addEventListener('touchstart', handleRefreshTouchStart);
            document.getElementById('refreshButtonBottomRight').addEventListener('touchstart', handleRefreshTouchStart);

            // Keyboard buttons
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);

            // Scroll wheel
            canvas.addEventListener('wheel', handleScroll);
        
            window.addEventListener('message', function(event) {
                if (event.data === 'closeIframe') {
                    let iframe = document.getElementById('clickableIframe');
                    document.getElementById('overlay').style.opacity = '1';
                    setTimeout(() => {
                        iframe.style.display = 'none';
                        iframe.src = ''; // Clear the iframe src to stop loading
                            setTimeout(() => {
                                document.getElementById('overlay').style.opacity = '0';
                        }, 1000); 
                    }, 1000); 
                }
            });

        }, 17000);
    }



    function isPointInPolygon(point, vs) {
        let x = point.x, y = point.y;
    
        let inside = false;
        for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
            let xi = vs[i].x, yi = vs[i].y;
            let xj = vs[j].x, yj = vs[j].y;
    
            let intersect = ((yi > y) != (yj > y)) &&
                (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
    
        return inside;
    }
    


    // Function to send the audio URL to the parent
    window.addEventListener('load', () => {
            const pageTitle = document.title; // Get the current iframe page's title
            const audioUrl = 'sounds/nav00.m4a'; // Change this to the appropriate audio URL for each iframe page

            window.parent.postMessage({
              action: 'changeAudio',
              url: audioUrl,
              title: pageTitle // Include the page title in the message
            }, '*');
    });

    // Add event listeners
    addEventListeners();
    
    window.slowDownAnimationNearest = slowDownAnimationNearest;

      // Function to handle back button and prevent default behavior
  function preventBackNavigation() {
    // Prevent the default back navigation
    history.pushState(null, null, window.location.href);
  }

  // Listen for the popstate event
  window.addEventListener('popstate', function(event) {
    preventBackNavigation();
  });

  // Initialize a state to prevent the initial popstate event from being fired
  history.pushState(null, null, window.location.href);

});


