document.addEventListener('DOMContentLoaded', () => {
    // Constants and Global Variables
    const canvas = document.getElementById('globeCanvas');
    const ctx = canvas.getContext('2d');
    const frameWidth = 350;
    const frameHeight = 350;
    const cols = 15;
    const totalFrames = 150;
    const initialFrameInterval = 1000 / 16;  // 16 fps for initial animation
    const buttonFrameInterval = 1000 / 32;  // 32 fps for button press animation
    const originalFrameWidth = 350;
    const originalFrameHeight = 350;
    let currentFrame = 10;  // Start at frame 10
    let animationInterval;
    let animationDirection = 1; // 1 for forward, -1 for backward
    let isAnimating = false; // Flag to track if animation is running
    const spriteSheet = new Image();
    spriteSheet.src = 'sprite.webp';

    const clickableAreas = [
        {
            imageIndex: 10,
            areas: [
                {
                    "id": "moon",
                    "points": [
                      {
                        "x": 397.52384,
                        "y": 120.29485
                      },
                      {
                        "x": 402.21114,
                        "y": 110.94414
                      },
                      {
                        "x": 401.42993,
                        "y": 106.29287000000001
                      },
                      {
                        "x": 399.47688,
                        "y": 97.07752300000001
                      },
                      {
                        "x": 395.57079,
                        "y": 91.60899800000001
                      },
                      {
                        "x": 387.56331,
                        "y": 90.24186700000001
                      },
                      {
                        "x": 378.384,
                        "y": 90.63247600000001
                      },
                      {
                        "x": 373.892,
                        "y": 100.20239000000001
                      },
                      {
                        "x": 373.11078,
                        "y": 106.29287000000001
                      },
                      {
                        "x": 376.34504,
                        "y": 117.38919000000001
                      },
                      {
                        "x": 382.09477999999996,
                        "y": 124.81076000000002
                      }
                    ],
                    "href": "location/moon.html"
                  },  
                {
                  "id": "cinema",
                  "points": [
                    {
                      "x": 315.15932,
                      "y": 321.23388
                    },
                    {
                      "x": 338.89777,
                      "y": 297.09303
                    },
                    {
                      "x": 351.27887999999996,
                      "y": 314.44692
                    },
                    {
                      "x": 360.62429999999995,
                      "y": 339.74168
                    },
                    {
                      "x": 331.36645999999996,
                      "y": 332.03862999999996
                    }
                  ],
                  "href": "location/cinema.html"
                },
                {
                  "id": "digital",
                  "points": [
                    {
                      "x": 326.86069,
                      "y": 286.64186
                    },
                    {
                      "x": 345.77083,
                      "y": 285.03251
                    },
                    {
                      "x": 358.77209999999997,
                      "y": 282.11809
                    },
                    {
                      "x": 382.7867,
                      "y": 287.44661
                    },
                    {
                      "x": 386.26837,
                      "y": 273.79178
                    },
                    {
                      "x": 376.20066,
                      "y": 265.56106
                    },
                    {
                      "x": 352.61085,
                      "y": 254.45417
                    },
                    {
                      "x": 338.5624,
                      "y": 255.06321
                    },
                    {
                      "x": 340.61193000000003,
                      "y": 241.21899
                    },
                    {
                      "x": 329.27471,
                      "y": 226.58782
                    },
                    {
                      "x": 309.55978000000005,
                      "y": 241.9811
                    },
                    {
                      "x": 307.99546000000004,
                      "y": 254.9373
                    },
                    {
                      "x": 322.03251000000006,
                      "y": 260.0866
                    },
                    {
                      "x": 322.51229000000006,
                      "y": 280.48042999999996
                    }
                  ],
                  "href": "location/digital.html"
                },
                {
                  "id": "cookie",
                  "points": [
                    {
                      "x": 318.05405,
                      "y": 183.28202
                    },
                    {
                      "x": 335.83204,
                      "y": 169.20001
                    },
                    {
                      "x": 341.79249,
                      "y": 156.72718999999998
                    },
                    {
                      "x": 336.81922,
                      "y": 139.66753999999997
                    },
                    {
                      "x": 320.87052,
                      "y": 137.81699999999998
                    },
                    {
                      "x": 307.63291,
                      "y": 139.66181999999998
                    },
                    {
                      "x": 294.777,
                      "y": 133.82644999999997
                    },
                    {
                      "x": 286.36505999999997,
                      "y": 125.80747999999997
                    },
                    {
                      "x": 275.60976999999997,
                      "y": 130.66323999999997
                    },
                    {
                      "x": 269.69584999999995,
                      "y": 142.19027999999997
                    },
                    {
                      "x": 261.28382999999997,
                      "y": 161.21041999999997
                    },
                    {
                      "x": 270.28405,
                      "y": 170.12057999999996
                    },
                    {
                      "x": 287.16366999999997,
                      "y": 157.72432999999995
                    },
                    {
                      "x": 290.06676999999996,
                      "y": 171.82882999999995
                    },
                    {
                      "x": 306.36778,
                      "y": 174.50981999999996
                    }
                  ],
                  "href": "location/cookie.html"
                },
                {
                  "id": "skate",
                  "points": [
                    {
                      "x": 303.16417,
                      "y": 132.93116
                    },
                    {
                      "x": 294.66013000000004,
                      "y": 121.69900000000001
                    },
                    {
                      "x": 280.48926000000006,
                      "y": 122.54684000000002
                    },
                    {
                      "x": 289.42426000000006,
                      "y": 113.03017000000001
                    },
                    {
                      "x": 293.5763800000001,
                      "y": 104.76546000000002
                    },
                    {
                      "x": 308.9149500000001,
                      "y": 106.63422000000001
                    },
                    {
                      "x": 306.2171400000001,
                      "y": 122.68605000000001
                    }
                  ],
                  "href": "location/skate.html"
                },
                {
                  "id": "santa",
                  "points": [
                    {
                      "x": 258.55782,
                      "y": 130.27015
                    },
                    {
                      "x": 274.34757,
                      "y": 130.27015
                    },
                    {
                      "x": 268.60008,
                      "y": 120.13788
                    },
                    {
                      "x": 264.24839,
                      "y": 102.6385
                    },
                    {
                      "x": 256.42456,
                      "y": 102.63847999999999
                    },
                    {
                      "x": 246.80961,
                      "y": 113.84937999999998
                    },
                    {
                      "x": 235.39439,
                      "y": 106.44322999999999
                    },
                    {
                      "x": 227.88747999999998,
                      "y": 115.36566999999998
                    },
                    {
                      "x": 230.89837999999997,
                      "y": 127.65700999999999
                    },
                    {
                      "x": 241.11093999999997,
                      "y": 135.08481999999998
                    },
                    {
                      "x": 257.70556999999997,
                      "y": 129.98560999999998
                    },
                    {
                      "x": 258.49357,
                      "y": 130.2488
                    }
                  ],
                  "href": "location/santa.html"
                },
                {
                  "id": "cheese",
                  "points": [
                    {
                      "x": 280.16508,
                      "y": 330.3082
                    },
                    {
                      "x": 297.86829,
                      "y": 338.35512
                    },
                    {
                      "x": 311.70164,
                      "y": 334.90604
                    },
                    {
                      "x": 313.76093,
                      "y": 320.86289
                    },
                    {
                      "x": 314.25692999999995,
                      "y": 307.25597
                    },
                    {
                      "x": 300.11126999999993,
                      "y": 307.07231
                    },
                    {
                      "x": 287.10856999999993,
                      "y": 301.92298
                    },
                    {
                      "x": 257.35414999999995,
                      "y": 302.58671
                    },
                    {
                      "x": 240.13142999999994,
                      "y": 306.16708
                    },
                    {
                      "x": 221.70634999999993,
                      "y": 313.97515
                    },
                    {
                      "x": 225.91391999999993,
                      "y": 335.28713
                    },
                    {
                      "x": 238.30692999999994,
                      "y": 335.48463
                    },
                    {
                      "x": 249.99844999999993,
                      "y": 340.63122999999996
                    },
                    {
                      "x": 260.0475399999999,
                      "y": 349.82237
                    },
                    {
                      "x": 270.44803999999993,
                      "y": 341.55102
                    },
                    {
                      "x": 279.71993999999995,
                      "y": 330.58009
                    }
                  ],
                  "href": "location/cheese.html"
                },
                {
                  "id": "cactus",
                  "points": [
                    {
                      "x": 271.52636,
                      "y": 371.56027
                    },
                    {
                      "x": 268.12182,
                      "y": 358.09779000000003
                    },
                    {
                      "x": 255.60863,
                      "y": 351.99244000000004
                    },
                    {
                      "x": 244.93214,
                      "y": 343.80593000000005
                    },
                    {
                      "x": 233.77474,
                      "y": 339.81338000000005
                    },
                    {
                      "x": 219.44868,
                      "y": 340.26704000000007
                    },
                    {
                      "x": 210.65440999999998,
                      "y": 353.2436600000001
                    },
                    {
                      "x": 214.02969,
                      "y": 365.4881900000001
                    },
                    {
                      "x": 237.2599,
                      "y": 370.7287400000001
                    },
                    {
                      "x": 254.40580999999997,
                      "y": 378.8573400000001
                    }
                  ],
                  "href": "location/cactus.html"
                },
                {
                  "id": "pirate",
                  "points": [
                    {
                      "x": 137.00626,
                      "y": 263.32735
                    },
                    {
                      "x": 142.09645,
                      "y": 242.20706
                    },
                    {
                      "x": 138.10943,
                      "y": 225.67495000000002
                    },
                    {
                      "x": 117.49277000000001,
                      "y": 226.91427000000002
                    },
                    {
                      "x": 105.1773,
                      "y": 240.14132
                    },
                    {
                      "x": 113.22991,
                      "y": 260.07112
                    },
                    {
                      "x": 126.52646,
                      "y": 265.34763
                    }
                  ],
                  "href": "location/pirate.html"
                },
                {
                  "id": "mushroom",
                  "points": [
                    {
                      "x": 202.72516,
                      "y": 224.92496
                    },
                    {
                      "x": 222.23907,
                      "y": 216.87793
                    },
                    {
                      "x": 227.88687,
                      "y": 203.13415
                    },
                    {
                      "x": 236.32101,
                      "y": 184.08673000000002
                    },
                    {
                      "x": 222.2484,
                      "y": 170.4695
                    },
                    {
                      "x": 208.17642,
                      "y": 164.6447
                    },
                    {
                      "x": 184.88797,
                      "y": 172.12701
                    },
                    {
                      "x": 179.4993,
                      "y": 184.72662000000003
                    },
                    {
                      "x": 168.14482,
                      "y": 201.6494
                    },
                    {
                      "x": 172.75096000000002,
                      "y": 217.88362
                    },
                    {
                      "x": 192.66949000000002,
                      "y": 224.73391
                    }
                  ],
                  "href": "location/mushroom.html"
                },
                {
                  "id": "crystal",
                  "points": [
                    {
                      "x": 223.64956,
                      "y": 156.49281
                    },
                    {
                      "x": 233.13557,
                      "y": 144.42239999999998
                    },
                    {
                      "x": 220.46154,
                      "y": 116.35690999999998
                    },
                    {
                      "x": 213.52389000000002,
                      "y": 115.91189999999999
                    },
                    {
                      "x": 196.21974000000003,
                      "y": 114.90705999999999
                    },
                    {
                      "x": 188.02336000000003,
                      "y": 125.73793999999998
                    },
                    {
                      "x": 184.45274000000003,
                      "y": 146.63527999999997
                    },
                    {
                      "x": 191.05008000000004,
                      "y": 158.48135999999997
                    },
                    {
                      "x": 221.22321000000005,
                      "y": 156.81684999999996
                    }
                  ],
                  "href": "location/crystal.html"
                }
              ]
        },
        {   imageIndex: 20,
            areas: [
                {
                  "id": "cookie",
                  "points": [
                    {
                      "x": 286.20029,
                      "y": 183.79271
                    },
                    {
                      "x": 301.04343,
                      "y": 172.85566
                    },
                    {
                      "x": 302.21526,
                      "y": 164.26226
                    },
                    {
                      "x": 308.465,
                      "y": 155.66886
                    },
                    {
                      "x": 304.94951999999995,
                      "y": 144.73181
                    },
                    {
                      "x": 297.52795,
                      "y": 141.60694
                    },
                    {
                      "x": 284.63786,
                      "y": 144.73181
                    },
                    {
                      "x": 282.68480999999997,
                      "y": 150.59094
                    },
                    {
                      "x": 274.48202999999995,
                      "y": 141.60693999999998
                    },
                    {
                      "x": 265.88863,
                      "y": 139.26328999999998
                    },
                    {
                      "x": 262.76376,
                      "y": 138.09145999999998
                    },
                    {
                      "x": 261.59193,
                      "y": 131.84171999999998
                    },
                    {
                      "x": 258.46706,
                      "y": 127.15440999999998
                    },
                    {
                      "x": 252.60793,
                      "y": 123.63892999999999
                    },
                    {
                      "x": 244.80295,
                      "y": 126.76379999999999
                    },
                    {
                      "x": 236.98357000000001,
                      "y": 131.45111
                    },
                    {
                      "x": 237.76479,
                      "y": 141.21633
                    },
                    {
                      "x": 222.14043,
                      "y": 143.55999
                    },
                    {
                      "x": 224.09347,
                      "y": 161.91861
                    },
                    {
                      "x": 238.1554,
                      "y": 171.68383
                    }
                  ],
                  "href": "location/cookie.html"
                },
                {
                  "id": "skate",
                  "points": [
                    {
                      "x": 288.41701,
                      "y": 139.53014
                    },
                    {
                      "x": 290.07422,
                      "y": 123.99376999999998
                    },
                    {
                      "x": 289.17656000000005,
                      "y": 117.43396999999999
                    },
                    {
                      "x": 288.96941000000004,
                      "y": 112.39326999999999
                    },
                    {
                      "x": 282.61676000000006,
                      "y": 106.80017999999998
                    },
                    {
                      "x": 277.23082000000005,
                      "y": 107.00732999999998
                    },
                    {
                      "x": 272.67348000000004,
                      "y": 110.11460999999998
                    },
                    {
                      "x": 269.84241000000003,
                      "y": 114.60288999999999
                    },
                    {
                      "x": 269.22095,
                      "y": 116.60535999999999
                    },
                    {
                      "x": 264.52551,
                      "y": 122.12939999999999
                    },
                    {
                      "x": 262.79925,
                      "y": 126.13432999999999
                    },
                    {
                      "x": 262.93735,
                      "y": 129.86306
                    },
                    {
                      "x": 264.04215999999997,
                      "y": 132.34887999999998
                    },
                    {
                      "x": 264.87077,
                      "y": 134.97280999999998
                    },
                    {
                      "x": 268.80665,
                      "y": 137.59672999999998
                    },
                    {
                      "x": 272.32822999999996,
                      "y": 138.42532999999997
                    },
                    {
                      "x": 279.78569,
                      "y": 140.01349999999996
                    }
                  ],
                  "href": "location/skate.html"
                },
                {
                  "id": "santa",
                  "points": [
                    {
                      "x": 252.64882,
                      "y": 121.09365
                    },
                    {
                      "x": 243.46509,
                      "y": 102.5881
                    },
                    {
                      "x": 238.21725,
                      "y": 105.21202
                    },
                    {
                      "x": 233.86707,
                      "y": 113.35998
                    },
                    {
                      "x": 230.13834,
                      "y": 120.40314
                    },
                    {
                      "x": 225.51195,
                      "y": 121.50795
                    },
                    {
                      "x": 223.16423,
                      "y": 114.32669
                    },
                    {
                      "x": 217.29493,
                      "y": 108.31929
                    },
                    {
                      "x": 211.83993999999998,
                      "y": 109.4241
                    },
                    {
                      "x": 208.59455999999997,
                      "y": 113.63619
                    },
                    {
                      "x": 209.00886999999997,
                      "y": 123.57947
                    },
                    {
                      "x": 209.07796999999997,
                      "y": 129.17256
                    },
                    {
                      "x": 210.18277999999995,
                      "y": 132.00363000000002
                    },
                    {
                      "x": 212.18523999999996,
                      "y": 136.63002
                    },
                    {
                      "x": 217.77833999999996,
                      "y": 138.14913
                    },
                    {
                      "x": 225.78819999999996,
                      "y": 135.24901000000003
                    },
                    {
                      "x": 231.45034999999996,
                      "y": 131.38218000000003
                    },
                    {
                      "x": 237.45774999999995,
                      "y": 129.31066000000004
                    },
                    {
                      "x": 242.36033999999995,
                      "y": 126.54864000000003
                    }
                  ],
                  "href": "location/santa.html"
                },
                {
                  "id": "crystal",
                  "points": [
                    {
                      "x": 194.4392,
                      "y": 115.7077
                    },
                    {
                      "x": 208.08742,
                      "y": 131.31313
                    },
                    {
                      "x": 210.52798,
                      "y": 136.63002
                    },
                    {
                      "x": 203.76103,
                      "y": 148.23051
                    },
                    {
                      "x": 196.02736000000002,
                      "y": 155.06652
                    },
                    {
                      "x": 175.45030000000003,
                      "y": 165.00979999999998
                    },
                    {
                      "x": 161.50208000000003,
                      "y": 146.64235
                    },
                    {
                      "x": 163.43550000000005,
                      "y": 135.17996
                    },
                    {
                      "x": 166.33562000000003,
                      "y": 132.14173
                    },
                    {
                      "x": 166.33562000000003,
                      "y": 118.74593
                    },
                    {
                      "x": 169.23575000000002,
                      "y": 112.39328
                    },
                    {
                      "x": 176.96941000000004,
                      "y": 112.94568000000001
                    }
                  ],
                  "href": "location/crystal.html"
                },
                {
                  "id": "mushroom",
                  "points": [
                    {
                      "x": 184.56497,
                      "y": 204.64482
                    },
                    {
                      "x": 195.33686,
                      "y": 188.34889
                    },
                    {
                      "x": 194.09395,
                      "y": 178.81991000000002
                    },
                    {
                      "x": 184.84117,
                      "y": 171.77675000000002
                    },
                    {
                      "x": 177.65992,
                      "y": 167.08132000000003
                    },
                    {
                      "x": 169.92625,
                      "y": 167.08132000000003
                    },
                    {
                      "x": 157.63525,
                      "y": 166.80511000000004
                    },
                    {
                      "x": 151.0064,
                      "y": 173.71017000000003
                    },
                    {
                      "x": 146.03476,
                      "y": 181.16763000000003
                    },
                    {
                      "x": 140.37261,
                      "y": 191.38711000000004
                    },
                    {
                      "x": 136.50578000000002,
                      "y": 199.53508000000005
                    },
                    {
                      "x": 134.84857000000002,
                      "y": 208.78785000000005
                    },
                    {
                      "x": 141.61552000000003,
                      "y": 214.31190000000004
                    },
                    {
                      "x": 150.17779000000004,
                      "y": 220.11214000000004
                    },
                    {
                      "x": 163.71170000000004,
                      "y": 222.59796000000003
                    },
                    {
                      "x": 178.07422000000003,
                      "y": 220.94075000000004
                    },
                    {
                      "x": 184.42687000000004,
                      "y": 205.19722000000004
                    }
                  ],
                  "href": "location/mushroom.html"
                },
                {
                  "id": "pirate",
                  "points": [
                    {
                      "x": 132.30038,
                      "y": 254.49292
                    },
                    {
                      "x": 131.32385,
                      "y": 233.59534
                    },
                    {
                      "x": 123.90227999999999,
                      "y": 225.78316999999998
                    },
                    {
                      "x": 113.35583999999999,
                      "y": 226.76689
                    },
                    {
                      "x": 108.66854,
                      "y": 232.61882
                    },
                    {
                      "x": 105.73897,
                      "y": 240.6263
                    },
                    {
                      "x": 108.47323,
                      "y": 249.80560999999997
                    },
                    {
                      "x": 115.8948,
                      "y": 253.71169999999998
                    },
                    {
                      "x": 122.53515,
                      "y": 258.98492
                    },
                    {
                      "x": 131.32385,
                      "y": 257.22718
                    }
                  ],
                  "href": "location/pirate.html"
                },
                {
                  "id": "cheese",
                  "points": [
                    {
                      "x": 190.69641,
                      "y": 315.81852
                    },
                    {
                      "x": 193.23537,
                      "y": 324.02130999999997
                    },
                    {
                      "x": 194.79781,
                      "y": 331.24757
                    },
                    {
                      "x": 198.31329,
                      "y": 335.15366
                    },
                    {
                      "x": 203.97711999999999,
                      "y": 334.95836
                    },
                    {
                      "x": 209.83624999999998,
                      "y": 333.78653
                    },
                    {
                      "x": 211.59399,
                      "y": 337.10671
                    },
                    {
                      "x": 216.86721,
                      "y": 346.67663000000005
                    },
                    {
                      "x": 219.60147,
                      "y": 348.62967000000003
                    },
                    {
                      "x": 224.48408,
                      "y": 349.21558000000005
                    },
                    {
                      "x": 229.17139,
                      "y": 349.21558000000005
                    },
                    {
                      "x": 233.8587,
                      "y": 340.81749
                    },
                    {
                      "x": 242.8427,
                      "y": 334.17714
                    },
                    {
                      "x": 249.28775000000002,
                      "y": 330.85697
                    },
                    {
                      "x": 263.34967,
                      "y": 334.95835999999997
                    },
                    {
                      "x": 269.20881,
                      "y": 335.93487999999996
                    },
                    {
                      "x": 278.97403,
                      "y": 331.24756999999994
                    },
                    {
                      "x": 283.07542,
                      "y": 315.62321999999995
                    },
                    {
                      "x": 282.48951,
                      "y": 307.6157299999999
                    },
                    {
                      "x": 276.43507,
                      "y": 300.9753799999999
                    },
                    {
                      "x": 266.66985,
                      "y": 301.1706899999999
                    },
                    {
                      "x": 259.44358,
                      "y": 304.68616999999995
                    },
                    {
                      "x": 252.60793,
                      "y": 300.38946999999996
                    },
                    {
                      "x": 244.80295,
                      "y": 296.67868
                    },
                    {
                      "x": 227.99956,
                      "y": 300.38946999999996
                    },
                    {
                      "x": 214.91416,
                      "y": 296.67868
                    },
                    {
                      "x": 202.60998,
                      "y": 303.70965
                    },
                    {
                      "x": 191.47763,
                      "y": 309.56878
                    }
                  ],
                  "href": "location/cheese.html"
                },
                {
                  "id": "cactus",
                  "points": [
                    {
                      "x": 238.64366,
                      "y": 373.9216
                    },
                    {
                      "x": 249.48305000000002,
                      "y": 376.55821000000003
                    },
                    {
                      "x": 257.78349000000003,
                      "y": 372.74977
                    },
                    {
                      "x": 260.71306000000004,
                      "y": 361.22681
                    },
                    {
                      "x": 260.61536000000007,
                      "y": 352.0475
                    },
                    {
                      "x": 256.6116200000001,
                      "y": 344.91889000000003
                    },
                    {
                      "x": 243.72152000000008,
                      "y": 336.03253
                    },
                    {
                      "x": 238.64361000000008,
                      "y": 341.0128
                    },
                    {
                      "x": 234.8351700000001,
                      "y": 345.21184000000005
                    },
                    {
                      "x": 232.8821300000001,
                      "y": 349.71558000000005
                    },
                    {
                      "x": 229.4398800000001,
                      "y": 354.51322000000005
                    },
                    {
                      "x": 223.2389700000001,
                      "y": 354.44002000000006
                    },
                    {
                      "x": 220.0896800000001,
                      "y": 352.3405000000001
                    },
                    {
                      "x": 217.6972000000001,
                      "y": 350.65600000000006
                    },
                    {
                      "x": 214.53286000000008,
                      "y": 348.27001000000007
                    },
                    {
                      "x": 210.6660300000001,
                      "y": 340.0184700000001
                    },
                    {
                      "x": 209.4455900000001,
                      "y": 337.9856200000001
                    },
                    {
                      "x": 205.7348100000001,
                      "y": 337.3997100000001
                    },
                    {
                      "x": 202.1216700000001,
                      "y": 341.4034500000001
                    },
                    {
                      "x": 198.6061900000001,
                      "y": 347.7508400000001
                    },
                    {
                      "x": 194.60245000000012,
                      "y": 352.8287600000001
                    },
                    {
                      "x": 192.8447100000001,
                      "y": 357.6137200000001
                    },
                    {
                      "x": 198.9968000000001,
                      "y": 366.01181000000014
                    }
                  ],
                  "href": "location/cactus.html"
                },
                {
                  "id": "lightbulb",
                  "points": [
                    {
                      "x": 282.2942,
                      "y": 335.38683
                    },
                    {
                      "x": 295.08664999999996,
                      "y": 330.56401
                    },
                    {
                      "x": 303.97299999999996,
                      "y": 327.9274
                    },
                    {
                      "x": 308.17204999999996,
                      "y": 329.29452999999995
                    },
                    {
                      "x": 312.27343999999994,
                      "y": 331.8334899999999
                    },
                    {
                      "x": 314.8123999999999,
                      "y": 334.6653999999999
                    },
                    {
                      "x": 315.98421999999994,
                      "y": 338.76679999999993
                    },
                    {
                      "x": 313.44526999999994,
                      "y": 344.0400199999999
                    },
                    {
                      "x": 303.77768999999995,
                      "y": 349.71557999999993
                    },
                    {
                      "x": 293.91481999999996,
                      "y": 347.55549999999994
                    },
                    {
                      "x": 286.98150999999996,
                      "y": 343.06348999999994
                    },
                    {
                      "x": 281.80593999999996,
                      "y": 341.11044999999996
                    }
                  ],
                  "href": "location/lightbulb.html"
                },
                {
                  "id": "cinema",
                  "points": [
                    {
                      "x": 296.94204,
                      "y": 323.92366
                    },
                    {
                      "x": 297.03964,
                      "y": 316.50209
                    },
                    {
                      "x": 299.5786,
                      "y": 308.4946
                    },
                    {
                      "x": 306.51191,
                      "y": 302.53782
                    },
                    {
                      "x": 312.76165,
                      "y": 297.94816000000003
                    },
                    {
                      "x": 318.42548,
                      "y": 294.62799
                    },
                    {
                      "x": 323.01513,
                      "y": 294.82329
                    },
                    {
                      "x": 328.97192,
                      "y": 296.14034
                    },
                    {
                      "x": 333.65923000000004,
                      "y": 307.61573
                    },
                    {
                      "x": 336.58879,
                      "y": 315.03729999999996
                    },
                    {
                      "x": 336.9794,
                      "y": 322.92796
                    },
                    {
                      "x": 337.95593,
                      "y": 331.44288
                    },
                    {
                      "x": 340.29958000000005,
                      "y": 337.10671
                    },
                    {
                      "x": 340.49488,
                      "y": 339.84097
                    },
                    {
                      "x": 336.00288,
                      "y": 338.82485
                    },
                    {
                      "x": 324.08931,
                      "y": 338.82485
                    },
                    {
                      "x": 317.21104,
                      "y": 334.94321
                    },
                    {
                      "x": 314.79427000000004,
                      "y": 332.18119
                    },
                    {
                      "x": 312.10130000000004,
                      "y": 329.21202
                    },
                    {
                      "x": 309.68453000000005,
                      "y": 327.40381
                    },
                    {
                      "x": 304.50574000000006,
                      "y": 324.99993
                    },
                    {
                      "x": 297.7387800000001,
                      "y": 325.75949
                    }
                  ],
                  "href": "location/cinema.html"
                },
                {
                  "id": "digital",
                  "points": [
                    {
                      "x": 318.74114,
                      "y": 282.42146
                    },
                    {
                      "x": 337.56537,
                      "y": 284.17920000000004
                    },
                    {
                      "x": 351.04137,
                      "y": 283.39798
                    },
                    {
                      "x": 357.68172999999996,
                      "y": 282.22615
                    },
                    {
                      "x": 360.41598999999997,
                      "y": 274.99989
                    },
                    {
                      "x": 355.14277,
                      "y": 264.06284
                    },
                    {
                      "x": 345.18224,
                      "y": 255.07882999999998
                    },
                    {
                      "x": 328.38606,
                      "y": 257.81309999999996
                    },
                    {
                      "x": 316.51724,
                      "y": 256.44597
                    },
                    {
                      "x": 307.09787,
                      "y": 253.51639999999998
                    },
                    {
                      "x": 300.26221,
                      "y": 252.53987999999998
                    },
                    {
                      "x": 296.44066999999995,
                      "y": 241.60282999999998
                    },
                    {
                      "x": 287.76273,
                      "y": 231.44698999999997
                    },
                    {
                      "x": 277.41159,
                      "y": 232.42351999999997
                    },
                    {
                      "x": 265.88863,
                      "y": 240.43099999999995
                    },
                    {
                      "x": 261.21373,
                      "y": 246.68073999999996
                    },
                    {
                      "x": 272.13837,
                      "y": 254.49291999999997
                    },
                    {
                      "x": 273.3102,
                      "y": 262.10979999999995
                    },
                    {
                      "x": 277.99751000000003,
                      "y": 274.21867
                    },
                    {
                      "x": 285.22377000000006,
                      "y": 283.59328999999997
                    },
                    {
                      "x": 286.39560000000006,
                      "y": 291.99138
                    },
                    {
                      "x": 296.44067000000007,
                      "y": 299.80356
                    },
                    {
                      "x": 303.77769000000006,
                      "y": 297.65521
                    }
                  ],
                  "href": "location/digital.html"
                },
                {
                  "id": "artificial",
                  "points": [
                    {
                      "x": 358.46294,
                      "y": 211.72124
                    },
                    {
                      "x": 367.64225,
                      "y": 215.04142
                    },
                    {
                      "x": 371.54834,
                      "y": 217.77568
                    },
                    {
                      "x": 374.47791,
                      "y": 224.02543
                    },
                    {
                      "x": 375.84504,
                      "y": 230.92482
                    },
                    {
                      "x": 375.84504,
                      "y": 236.52491
                    },
                    {
                      "x": 371.93895,
                      "y": 240.2357
                    },
                    {
                      "x": 367.64225,
                      "y": 247.46196
                    },
                    {
                      "x": 359.63477,
                      "y": 248.04787000000002
                    },
                    {
                      "x": 355.14277,
                      "y": 245.89952000000002
                    },
                    {
                      "x": 353.18971999999997,
                      "y": 239.84509000000003
                    },
                    {
                      "x": 352.2132,
                      "y": 230.92482000000004
                    },
                    {
                      "x": 353.18971999999997,
                      "y": 224.41603000000003
                    },
                    {
                      "x": 354.36154999999997,
                      "y": 216.21325000000004
                    }
                  ],
                  "href": "location/artificial.html"
                },
                {
                  "id": "moon",
                  "points": [
                    {
                      "x": 397.52384,
                      "y": 120.29485
                    },
                    {
                      "x": 402.21114,
                      "y": 110.94414
                    },
                    {
                      "x": 401.42993,
                      "y": 106.29287000000001
                    },
                    {
                      "x": 399.47688,
                      "y": 97.07752300000001
                    },
                    {
                      "x": 395.57079,
                      "y": 91.60899800000001
                    },
                    {
                      "x": 387.56331,
                      "y": 90.24186700000001
                    },
                    {
                      "x": 378.384,
                      "y": 90.63247600000001
                    },
                    {
                      "x": 373.892,
                      "y": 100.20239000000001
                    },
                    {
                      "x": 373.11078,
                      "y": 106.29287000000001
                    },
                    {
                      "x": 376.34504,
                      "y": 117.38919000000001
                    },
                    {
                      "x": 382.09477999999996,
                      "y": 124.81076000000002
                    }
                  ],
                  "href": "location/moon.html"
                }
              ]
        },
        {   imageIndex: 30,
            areas: []
        }
        // Add more frames and their areas as needed
    ];

    // Initialize
    spriteSheet.onload = () => {
        resizeCanvas(); // Initial draw
        drawFrame(currentFrame); // Ensure initial frame is drawn
        window.addEventListener('resize', resizeCanvas);
        startAnimation(true, initialFrameInterval); // Start initial animation at 16fps
    };

    // Resize Canvas
    function resizeCanvas() {
        const size = Math.min(window.innerWidth, window.innerHeight, 500);
        canvas.width = size;
        canvas.height = size;
        drawFrame(currentFrame);
    }

// Define manual offset variables
let offsetX = -70;
let offsetY = -50;

// Draw Frame
function drawFrame(frameIndex) {
    const x = ((frameIndex - 1) % cols) * frameWidth;
    const y = Math.floor((frameIndex - 1) / cols) * frameHeight;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(spriteSheet, x, y, frameWidth, frameHeight, 0, 0, canvas.width, canvas.height);

    // Draw clickable areas with a red outline
    const currentFrameAreas = clickableAreas.find(area => area.imageIndex === frameIndex);
    if (currentFrameAreas) {
        const scaleX = canvas.width / originalFrameWidth;
        const scaleY = canvas.height / originalFrameHeight;
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 2;
        currentFrameAreas.areas.forEach(area => {
            ctx.beginPath();
            ctx.moveTo((area.points[0].x + offsetX) * scaleX, (area.points[0].y + offsetY) * scaleY);
            for (let i = 1; i < area.points.length; i++) {
                ctx.lineTo((area.points[i].x + offsetX) * scaleX, (area.points[i].y + offsetY) * scaleY);
            }
            ctx.closePath();
            ctx.stroke();
        });
    }

    // Update frame info
    frameInfo.textContent = `Frame: ${frameIndex}`;
};
    

    // Start Animation
    function startAnimation(forward = true, interval = initialFrameInterval) {
        clearInterval(animationInterval);  // Clear any existing interval
        animationDirection = forward ? 1 : -1;

        if (isAnimating && interval === buttonFrameInterval) {
            animationInterval = setInterval(updateFrame, interval);
            return; // Prevent starting multiple button animations
        }

        isAnimating = true;
        animationInterval = setInterval(updateFrame, interval);
    }

    // Update Frame
    function updateFrame() {
        currentFrame = (currentFrame + animationDirection - 1 + totalFrames) % totalFrames + 1;
        drawFrame(currentFrame);
    }

    // Stop Animation at Nearest Multiple of 10 in the Correct Direction
    function stopAnimationNearest(direction) {
        clearInterval(animationInterval);
        animationInterval = setInterval(() => {
            currentFrame = (currentFrame + direction - 1 + totalFrames) % totalFrames + 1;
            drawFrame(currentFrame);

            // Ensure stopping on next multiple of 10 in the correct direction
            if (currentFrame % 10 === 0) {
                clearInterval(animationInterval);
                isAnimating = false; // Reset the flag
            }
        }, buttonFrameInterval);
    }

// Slow Down Animation and Stop at Nearest Multiple of 10
function slowDownAnimationNearest(direction) {
    clearInterval(animationInterval);
    isAnimating = true;

    let interval = buttonFrameInterval;
    const decelerationFactor = 1.5; // Factor by which to slow down each step
    const minInterval = 1000 / 13; // Minimum interval for 12fps

    function decelerate() {
        currentFrame = (currentFrame + direction - 1 + totalFrames) % totalFrames + 1;
        drawFrame(currentFrame);

        if (currentFrame % 10 === 0 && interval >= minInterval) {
            clearInterval(animationInterval);
            isAnimating = false; // Reset the flag
        } else {
            interval = Math.min(interval * decelerationFactor, minInterval);
            clearInterval(animationInterval);
            animationInterval = setInterval(decelerate, interval);
        }
    }

    animationInterval = setInterval(decelerate, interval);
}

    // Handle Key Down
    function handleKeyDown(event) {
        if ((event.key === 'ArrowLeft' || event.key === 'ArrowRight') && !keyPressed) {
            keyPressed = true;
            startAnimation(event.key === 'ArrowRight', buttonFrameInterval);
        }
    }

    // Handle Key Up
    function handleKeyUp(event) {
        if (event.key === 'ArrowLeft' || event.key === 'ArrowRight') {
            keyPressed = false;
            stopAnimationNearest(event.key === 'ArrowRight' ? 1 : -1);
        }
    }

    // Handle Scroll
    function handleScroll(event) {
        const now = Date.now();
        if (now - lastScrollTime < scrollFrameInterval) return;
        lastScrollTime = now;

        clearInterval(animationInterval);  // Stop any currently running animations
        isAnimating = false; // Reset the flag

        const delta = event.deltaY > 0 ? 1 : -1;
        animationDirection = delta;  // Set the animation direction based on the scroll direction
        currentFrame = (currentFrame + delta - 1 + totalFrames) % totalFrames + 1;
        drawFrame(currentFrame);

        // Ensure the animation stops on multiples of 10
        stopAnimationNearest(delta);
    }

    // Handle Touch Start
    function handleTouchStart(event) {
        event.preventDefault();
        const button = event.target;
        button.style.opacity = '1';

        if (button.id.includes('leftButton')) {
            startAnimation(false, buttonFrameInterval);
        } else if (button.id.includes('rightButton')) {
            startAnimation(true, buttonFrameInterval);
        }

        button.addEventListener('touchend', function touchEnd() {
            button.style.opacity = '0.2';
            stopAnimationNearest(button.id.includes('rightButton') ? 1 : -1);
            button.removeEventListener('touchend', touchEnd);
        });

        button.addEventListener('touchmove', function touchMove() {
            button.style.opacity = '0.2';
            stopAnimationNearest(button.id.includes('rightButton') ? 1 : -1);
            button.removeEventListener('touchmove', touchMove);
        });
    }

    // Handle Touch Start for Refresh Buttons
    function handleRefreshTouchStart(event) {
        event.preventDefault();
        const button = event.target;
        button.style.opacity = '1';

        startAnimation(true, initialFrameInterval); // Mimic the click behavior

        button.addEventListener('touchend', function touchEnd() {
            button.style.opacity = '0.2';
            button.removeEventListener('touchend', touchEnd);
        });

        button.addEventListener('touchmove', function touchMove() {
            button.style.opacity = '0.2';
            button.removeEventListener('touchmove', touchMove);
        });
    }

// Handle Click Events
canvas.addEventListener('click', function(event) {
    const rect = canvas.getBoundingClientRect();
    const x = (event.clientX - rect.left) * (canvas.width / rect.width);
    const y = (event.clientY - rect.top) * (canvas.height / rect.height);

    const currentFrameAreas = clickableAreas.find(area => area.imageIndex === currentFrame);
    if (currentFrameAreas) {
        const scaleX = canvas.width / originalFrameWidth;
        const scaleY = canvas.height / originalFrameHeight;
        currentFrameAreas.areas.forEach(area => {
            const translatedPoints = area.points.map(point => ({
                x: (point.x + offsetX) * scaleX,
                y: (point.y + offsetY) * scaleY
            }));
            if (isPointInPolygon({ x, y }, translatedPoints)) {
                handleClick(area.href);
            }
        });
    }
});

// Cursor change on hover
canvas.addEventListener('mousemove', function(event) {
    const rect = canvas.getBoundingClientRect();
    const x = (event.clientX - rect.left) * (canvas.width / rect.width);
    const y = (event.clientY - rect.top) * (canvas.height / rect.height);

    const currentFrameAreas = clickableAreas.find(area => area.imageIndex === currentFrame);
    if (currentFrameAreas) {
        const scaleX = canvas.width / originalFrameWidth;
        const scaleY = canvas.height / originalFrameHeight;
        let isHovering = false;
        currentFrameAreas.areas.forEach(area => {
            const translatedPoints = area.points.map(point => ({
                x: (point.x + offsetX) * scaleX,
                y: (point.y + offsetY) * scaleY
            }));
            if (isPointInPolygon({ x, y }, translatedPoints)) {
                isHovering = true;
            }
        });
        canvas.style.cursor = isHovering ? 'pointer' : 'default';
    } else {
        canvas.style.cursor = 'default';
    }
});

// Handle iframe src change
    function handleClick(href) {
        document.getElementById('overlay').style.opacity = '1';
        setTimeout(() => {
            if (href) {
                let iframe = document.getElementById('clickableIframe');
                iframe.src = href;
                iframe.style.display = 'block'; // Show the iframe
            }
            setTimeout(() => {
                if (href) {
                    document.getElementById('overlay').style.opacity = '0';
                }
            }, 1000); 
        }, 1000); 
        
    };


    function isPointInPolygon(point, vs) {
        let x = point.x, y = point.y;
    
        let inside = false;
        for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
            let xi = vs[i].x, yi = vs[i].y;
            let xj = vs[j].x, yj = vs[j].y;
    
            let intersect = ((yi > y) != (yj > y)) &&
                (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
    
        return inside;
    };
    
    

    // Add event listeners
    function addEventListeners() {
        setTimeout(() => {
            // Horizontal buttons
            document.getElementById('leftButtonHorizontal').addEventListener('mousedown', () => startAnimation(false, buttonFrameInterval));
            document.getElementById('rightButtonHorizontal').addEventListener('mousedown', () => startAnimation(true, buttonFrameInterval));
            document.getElementById('leftButtonHorizontal').addEventListener('mouseup', () => stopAnimationNearest(-1));
            document.getElementById('rightButtonHorizontal').addEventListener('mouseup', () => stopAnimationNearest(1));

            // Add touch event listeners for horizontal buttons
            document.getElementById('leftButtonHorizontal').addEventListener('touchstart', handleTouchStart);
            document.getElementById('rightButtonHorizontal').addEventListener('touchstart', handleTouchStart);

            // Vertical buttons
            document.getElementById('leftButtonVertical').addEventListener('mousedown', () => startAnimation(false, buttonFrameInterval));
            document.getElementById('rightButtonVertical').addEventListener('mousedown', () => startAnimation(true, buttonFrameInterval));
            document.getElementById('leftButtonVertical').addEventListener('mouseup', () => stopAnimationNearest(-1));
            document.getElementById('rightButtonVertical').addEventListener('mouseup', () => stopAnimationNearest(1));

            // Add touch event listeners for vertical buttons
            document.getElementById('leftButtonVertical').addEventListener('touchstart', handleTouchStart);
            document.getElementById('rightButtonVertical').addEventListener('touchstart', handleTouchStart);

            // Refresh buttons
            document.getElementById('refreshButton').addEventListener('click', () => startAnimation(true, initialFrameInterval));
            document.getElementById('refreshButtonVertical').addEventListener('click', () => startAnimation(true, initialFrameInterval));
            document.getElementById('refreshButtonBottomRight').addEventListener('click', () => startAnimation(true, initialFrameInterval));

            // Add touch event listeners for refresh buttons
            document.getElementById('refreshButton').addEventListener('touchstart', handleRefreshTouchStart);
            document.getElementById('refreshButtonVertical').addEventListener('touchstart', handleRefreshTouchStart);
            document.getElementById('refreshButtonBottomRight').addEventListener('touchstart', handleRefreshTouchStart);

            // Keyboard buttons
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);

            // Scroll wheel
            canvas.addEventListener('wheel', handleScroll);
        
            window.addEventListener('message', function(event) {
                if (event.data === 'closeIframe') {
                    let iframe = document.getElementById('clickableIframe');
                    document.getElementById('overlay').style.opacity = '1';
                    setTimeout(() => {
                        iframe.style.display = 'none';
                        iframe.src = ''; // Clear the iframe src to stop loading
                            setTimeout(() => {
                                document.getElementById('overlay').style.opacity = '0';
                        }, 1000); 
                    }, 1000); 
                }
            });

        }, 17000);
    }



    function isPointInPolygon(point, vs) {
        let x = point.x, y = point.y;
    
        let inside = false;
        for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
            let xi = vs[i].x, yi = vs[i].y;
            let xj = vs[j].x, yj = vs[j].y;
    
            let intersect = ((yi > y) != (yj > y)) &&
                (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
            if (intersect) inside = !inside;
        }
    
        return inside;
    }
    


    // Function to send the audio URL to the parent
    window.addEventListener('load', () => {
            const pageTitle = document.title; // Get the current iframe page's title
            const audioUrl = 'sounds/nav00.m4a'; // Change this to the appropriate audio URL for each iframe page

            window.parent.postMessage({
              action: 'changeAudio',
              url: audioUrl,
              title: pageTitle // Include the page title in the message
            }, '*');
    });

    // Add event listeners
    addEventListeners();
    
    window.slowDownAnimationNearest = slowDownAnimationNearest;

      // Function to handle back button and prevent default behavior
  function preventBackNavigation() {
    // Prevent the default back navigation
    history.pushState(null, null, window.location.href);
  }

  // Listen for the popstate event
  window.addEventListener('popstate', function(event) {
    preventBackNavigation();
  });

  // Initialize a state to prevent the initial popstate event from being fired
  history.pushState(null, null, window.location.href);

});


