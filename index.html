<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href='https://fonts.googleapis.com/css?family=Press+Start+2P' rel='stylesheet'>
  <title>Small Planet Phantasmagoria</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden; /* Prevent scrollbars in the main page */
      display: flex;
      flex-direction: column;
      height: 100vh;
      position: relative; /* Position for absolute children */
    }

    iframe {
      border: none; /* Remove iframe border */
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      position: absolute; /* Cover entire area */
      top: 0;
      left: 0;
      background: black; /* Background color */
    }

    img {
      /* Disable image smoothing/anti-aliasing */
      image-rendering: optimizeSpeed;             /* STOP SMOOTHING, GIVE ME SPEED  */
      image-rendering: -moz-crisp-edges;          /* Firefox                        */
      image-rendering: -o-crisp-edges;            /* Opera                          */
      image-rendering: -webkit-optimize-contrast; /* Chrome (and eventually Safari) */
      image-rendering: pixelated;                 /* Universal support since 2021   */
      image-rendering: optimize-contrast;         /* CSS3 Proposed                  */
      -ms-interpolation-mode: nearest-neighbor;   /* IE8+                           */
    }

    .bottom-right-container {
      position: absolute; /* Position in bottom-right corner */
      bottom: 10px;
      right: 35px;
      background: #000; /* Black background */
      color: white; /* White text */
      padding: 0; /* No padding */
      z-index: 100; /* Ensure above iframe */
      display: flex;
      align-items: center; /* Center items vertically */
    }

    .audio-player {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
      background: rgb(49, 49, 49);
      border-bottom: 4px solid rgb(0, 0, 0);
      cursor: pointer;
      margin-right: 10px;
      flex-shrink: 0;
      transition: 0.2s; /* Smooth background color transition */
    }

    .audio-player:hover {
      background: gray; /* Change background on hover */
    }

    .audio-player svg {
      width: 30px;
      height: 30px;
      fill: rgb(0, 0, 0); /* Icon color */
    }

    .menu {
      display: flex;
      align-items: center;
      justify-content: center;
      filter: grayscale(100%) brightness(50%);
      transition: 0.5s; /* Smooth transition for filter */
      flex-shrink: 0;
    }

    .menu-img {
      width: 50px;
      height: 50px;
      transition: 0.2s; /* Smooth transition for image */
    }

    .menu .tooltiptext {
      visibility: hidden;
      width: 53px;
      background-color: #fff; /* White background */
      color: #000; /* Black text */
      font-family: 'Press Start 2P', monospace;
      font-size: 8px;
      text-align: center;
      border-radius: 20px;
      padding: 8px 0;
      position: absolute;
      z-index: 1;
      bottom: 102%;
      left: 96%;
      margin-left: -50px;
      opacity: 0;
      transition: opacity 0.2s; /* Fade transition for tooltip */
    }

    .menu .tooltiptext::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #fff transparent transparent transparent; /* Tooltip arrow */
    }

    .menu:hover {
      filter: grayscale(0%) brightness(100%); /* Remove grayscale and increase brightness on hover */
      transition: 0.2s;
    }

    /* Splash Screen Styles */
    .splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: black;
      z-index: 20; /* Ensure above all other content */
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 3s ease; /* Fade-out transition */
      opacity: 1;
      cursor: pointer; /* Change cursor to pointer */
      overflow: hidden; /* Hide overflow */
    }

    .splash-screen img {
      position: absolute;
      width: 450px; /* Fixed width */
      height: 330px; /* Fixed height */
      object-fit: cover; /* Ensure images fit their container */
    }

    .splash-screen img:first-child {
      animation: sizeTransition 10s forwards, fadeIn 10s forwards; /* Apply animations */
    }

    .splash-screen img:last-child {
      width: 550px !important;
      opacity: 0; /* Initial opacity */
      animation: fadeIn 5s forwards; /* Apply fade-in animation */
    }

    @keyframes sizeTransition {
      from {
        transform: scale(0.5); /* Start at 100% */
      }
      to {
        transform: scale(1.5); /* Adjust final scale */
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .splash-screen.fade-out {
      opacity: 0;
      pointer-events: none; /* Allow clicks to pass through */
    }
  </style>
</head>
<body>
  <iframe id="main-frame" src="nav.html"></iframe>

  <div class="bottom-right-container">
    <div class="audio-player" id="audio-button">
      <!-- Music Note Icon -->
      <svg id="music-note-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 3v10.55A4 4 0 1 0 14 17V7h4V3h-6z"/>
      </svg>
      <!-- Play Icon -->
      <svg id="play-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <path d="M8 5v14l11-7L8 5z"/>
      </svg>
      <!-- Pause Icon -->
      <svg id="pause-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
      </svg>
      <audio id="audio-player" loop>
        <source id="audio-source" src="sounds/nav00.m4a" type="audio/mpeg">
      </audio>
    </div>

    <div class="menu">
      <a href="about.html" onmouseover="changeImage(this)" onmouseout="resetImage(this)">
        <img src="images/menu.gif" class="menu-img">
        <span class="tooltiptext">ABOUT</span>
      </a>
    </div>
  </div>

  <!-- Splash Screen -->
  <div class="splash-screen" id="splash-screen">
    <img src="images/nav00a.webp" alt="Splash Image 1">
    <img id="nav00b2" src="images/nav00b2.webp" alt="Splash Image 2" style="animation-delay: 10s;">
  </div>

  <script>
    // Elements
    const iframe = document.getElementById('main-frame');
    const audioPlayer = document.getElementById('audio-player');
    const audioSource = document.getElementById('audio-source');
    const audioButton = document.getElementById('audio-button');
    const musicNoteIcon = document.getElementById('music-note-icon');
    const playIcon = document.getElementById('play-icon');
    const pauseIcon = document.getElementById('pause-icon');
    const splashScreen = document.getElementById('splash-screen');

    let fadeDuration = 1000; // Fade duration in milliseconds

    window.addEventListener('message', (event) => {
  // Optionally check event.origin for security purposes
  if (event.data.action === 'changeAudio') {
    const wasPlaying = !audioPlayer.paused; // Check if audio was playing

    fadeOutAudio(() => {
      audioSource.src = event.data.url; // Set new audio source
      audioPlayer.load(); // Reload audio element
      if (wasPlaying) {
        fadeInAudio(); // Fade in audio only if it was playing
      }
    });

    document.title = event.data.title; // Update the browser tab title
  }
});
    let tooltipTimeout;

    // Change image and show tooltip
    function changeImage(element) {
      const img = element.querySelector('.menu-img');
      img.src = 'images/menu2.gif';

      tooltipTimeout = setTimeout(() => {
        const tooltip = element.querySelector('.tooltiptext');
        tooltip.style.visibility = 'visible';
        tooltip.style.opacity = '1';
      }, 2000);
    }

    // Reset image and hide tooltip
    function resetImage(element) {
      const img = element.querySelector('.menu-img');
      img.src = 'images/menu.gif';

      clearTimeout(tooltipTimeout);
      const tooltip = element.querySelector('.tooltiptext');
      tooltip.style.visibility = 'hidden';
      tooltip.style.opacity = '0';
    }

    // Fade in audio
    function fadeInAudio() {
      let volume = 0;
      audioPlayer.volume = volume;
      audioPlayer.play();

      const interval = setInterval(() => {
        if (volume < 1) {
          volume += 0.05;
          audioPlayer.volume = Math.min(volume, 1);
        } else {
          clearInterval(interval);
        }
      }, fadeDuration / 20); // Adjust interval timing for smoother fade-in
    }

    // Fade out audio
    function fadeOutAudio(callback) {
      let volume = audioPlayer.volume;

      const interval = setInterval(() => {
        if (volume > 0) {
          volume -= 0.05;
          audioPlayer.volume = Math.max(volume, 0);
        } else {
          clearInterval(interval);
          audioPlayer.pause();
          if (callback) callback();
        }
      }, fadeDuration / 20); // Adjust interval timing for smoother fade-out
    }

    // Handle audio button hover and click events
    audioButton.addEventListener('mouseover', () => {
      if (audioPlayer.paused && musicNoteIcon.style.display === 'block') {
        musicNoteIcon.style.display = 'none';
        playIcon.style.display = 'block';
      }
      audioButton.style.background = 'gray';
    });

    audioButton.addEventListener('mouseout', () => {
      if (audioPlayer.paused) {
        playIcon.style.display = 'none';
        musicNoteIcon.style.display = 'block';
      }
      audioButton.style.background = 'rgb(49, 49, 49)';
    });

    audioButton.addEventListener('click', () => {
      if (audioPlayer.paused) {
        fadeInAudio();
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
        musicNoteIcon.style.display = 'none';
      } else {
        fadeOutAudio(() => {
          pauseIcon.style.display = 'none';
          playIcon.style.display = 'none';
          musicNoteIcon.style.display = 'block';
        });
      }
    });

    // Handle splash screen click to fade out
    splashScreen.addEventListener('click', () => {
      splashScreen.classList.add('fade-out');
      focusIframe();
    });

    // Function to set focus to the iframe
    function focusIframe() {
      if (iframe) {
        iframe.contentWindow.focus();
      }
    }

    // Function to attach the load event to the iframe
    function attachIframeLoadEvent() {
      if (iframe) {
        iframe.addEventListener('load', focusIframe);
      }
    }

    // Attach the load event to the iframe when the main window loads
    window.onload = function() {
      attachIframeLoadEvent();
    };

    // Function to reload the image with a unique query parameter
    function reloadImage() {
      var img = document.getElementById('nav00b2');
      var timestamp = new Date().getTime(); // Unique timestamp
      img.src = 'images/nav00b2.webp' + '?' + timestamp;
    }
  </script>
</body>
</html>
